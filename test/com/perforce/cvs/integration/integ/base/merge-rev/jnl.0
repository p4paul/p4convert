@pv@ 0 @db.depot@ @import@ 0 @subdir@ @import/...@ 
@pv@ 3 @db.domain@ @import@ 100 @@ @@ @@ @@ @svn-user@ 0 0 0 1 @Created by svn-user@ 
@pv@ 3 @db.user@ @svn-user@ @svn-user@@svn-client@ @@ 0 0 @svn-user@ @@ 0 @@ 0 
@pv@ 0 @db.view@ @svn-client@ 0 0 @//svn-client/...@ @//import/...@ 
@pv@ 3 @db.domain@ @svn-client@ 99 @@ @/ws@ @@ @@ @svn-user@ 0 0 0 1 @Created by svn-user@ 
@pv@ 0 @db.desc@ 1 @Initial revision
@ 
@pv@ 0 @db.change@ 1 1 @svn-client@ @jfb@ 1089756160 1 @Initial revision
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 1 1 0 1 1089756160 1089756160 00000000000000000000000000000000 @//import/main/checkout.c@ @1.1@ 1 
@pv@ 0 @db.revcx@ 1 @//import/main/checkout.c@ 1 0 
@pv@ 0 @db.desc@ 2 @* initial import from the cvs-tools module
@ 
@pv@ 0 @db.change@ 2 2 @svn-client@ @jfb@ 1089756160 1 @* initial import from the cvs-t@ 
@pv@ 3 @db.rev@ @//import/OpenCVS/checkout.c@ 1 1 0 2 1089756160 1089756160 00000000000000000000000000000000 @//import/OpenCVS/checkout.c@ @1.2@ 1 
@pv@ 0 @db.revcx@ 2 @//import/OpenCVS/checkout.c@ 1 0 
@pv@ 0 @db.desc@ 3 @Initial revision
@ 
@pv@ 0 @db.change@ 3 3 @svn-client@ @jfb@ 1089756160 1 @Initial revision
@ 
@pv@ 0 @db.integed@ @//import/OpenCVS/checkout.c@ @//import/main/checkout.c@ 0 1 1 2 4 3 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OpenCVS/checkout.c@ 1 2 0 1 5 3 
@pv@ 3 @db.rev@ @//import/OpenCVS/checkout.c@ 2 1 4 3 1089756160 1089756160 00000000000000000000000000000000 @//import/main/checkout.c@ @1.1@ 1 
@pv@ 0 @db.revcx@ 3 @//import/OpenCVS/checkout.c@ 2 4 
@pv@ 0 @db.desc@ 4 @* make checkout work in remote mode (almost)
@ 
@pv@ 0 @db.change@ 4 4 @svn-client@ @jfb@ 1090863030 1 @* make checkout work in remote @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 2 1 1 4 1090863030 1090863030 00000000000000000000000000000000 @//import/main/checkout.c@ @1.4@ 1 
@pv@ 0 @db.revcx@ 4 @//import/main/checkout.c@ 2 1 
@pv@ 0 @db.desc@ 5 @Pass the appropriate argument to cvs_client_connect()
@ 
@pv@ 0 @db.change@ 5 5 @svn-client@ @jfb@ 1090980089 1 @Pass the appropriate argument t@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 3 1 1 5 1090980089 1090980089 00000000000000000000000000000000 @//import/main/checkout.c@ @1.5@ 1 
@pv@ 0 @db.revcx@ 5 @//import/main/checkout.c@ 3 1 
@pv@ 0 @db.desc@ 6 @Don't export `cvs_root'
@ 
@pv@ 0 @db.change@ 6 6 @svn-client@ @jfb@ 1091125965 1 @Don't export `cvs_root'
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 4 1 1 6 1091125965 1091125965 00000000000000000000000000000000 @//import/main/checkout.c@ @1.6@ 1 
@pv@ 0 @db.revcx@ 6 @//import/main/checkout.c@ 4 1 
@pv@ 0 @db.desc@ 7 @Move to the new API for the client-server protocol.  All functions now
take a cvs root structure as parameter.  This will allow for much easier
management of CVS trees that make use of multiple roots.
@ 
@pv@ 0 @db.change@ 7 7 @svn-client@ @jfb@ 1091152162 1 @Move to the new API for the cli@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 5 1 1 7 1091152162 1091152162 00000000000000000000000000000000 @//import/main/checkout.c@ @1.7@ 1 
@pv@ 0 @db.revcx@ 7 @//import/main/checkout.c@ 5 1 
@pv@ 0 @db.desc@ 8 @Fix
@ 
@pv@ 0 @db.change@ 8 8 @svn-client@ @jfb@ 1091211247 1 @Fix
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 6 1 1 8 1091211247 1091211247 00000000000000000000000000000000 @//import/main/checkout.c@ @1.8@ 1 
@pv@ 0 @db.revcx@ 8 @//import/main/checkout.c@ 6 1 
@pv@ 0 @db.desc@ 9 @Don't MKADMIN on cvs_file_get()
@ 
@pv@ 0 @db.change@ 9 9 @svn-client@ @jfb@ 1091508987 1 @Don't MKADMIN on cvs_file_get()
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 7 1 1 9 1091508987 1091508987 00000000000000000000000000000000 @//import/main/checkout.c@ @1.9@ 1 
@pv@ 0 @db.revcx@ 9 @//import/main/checkout.c@ 7 1 
@pv@ 0 @db.desc@ 10 @Start using the global files list
@ 
@pv@ 0 @db.change@ 10 10 @svn-client@ @jfb@ 1091797719 1 @Start using the global files li@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 8 1 1 10 1091797719 1091797719 00000000000000000000000000000000 @//import/main/checkout.c@ @1.10@ 1 
@pv@ 0 @db.revcx@ 10 @//import/main/checkout.c@ 8 1 
@pv@ 0 @db.desc@ 11 @Add error checking and move the protocol calls so we only send them if
the cvs server is remote
@ 
@pv@ 0 @db.change@ 11 11 @svn-client@ @jfb@ 1092344626 1 @Add error checking and move the@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 9 1 1 11 1092344626 1092344626 00000000000000000000000000000000 @//import/main/checkout.c@ @1.11@ 1 
@pv@ 0 @db.revcx@ 11 @//import/main/checkout.c@ 9 1 
@pv@ 0 @db.desc@ 12 @Match more closely the data sent by GNU CVS when dealing with multiple
modules.  Our checkout command can now perform the checkout of several
modules at once.
@ 
@pv@ 0 @db.change@ 12 12 @svn-client@ @jfb@ 1101485113 1 @Match more closely the data sen@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 10 1 1 12 1101485113 1101485113 00000000000000000000000000000000 @//import/main/checkout.c@ @1.12@ 1 
@pv@ 0 @db.revcx@ 12 @//import/main/checkout.c@ 10 1 
@pv@ 0 @db.desc@ 13 @less whitespace, more pretty.  ok jfb
@ 
@pv@ 0 @db.change@ 13 13 @svn-client@ @tedu@ 1102439456 1 @less whitespace, more pretty.  @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 11 1 1 13 1102439456 1102439456 00000000000000000000000000000000 @//import/main/checkout.c@ @1.13@ 1 
@pv@ 0 @db.revcx@ 13 @//import/main/checkout.c@ 11 1 
@pv@ 0 @db.desc@ 14 @cleaner error handling on connection setup and in case of connection
failure
@ 
@pv@ 0 @db.change@ 14 14 @svn-client@ @jfb@ 1102986711 1 @cleaner error handling on conne@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 12 1 1 14 1102986711 1102986711 00000000000000000000000000000000 @//import/main/checkout.c@ @1.14@ 1 
@pv@ 0 @db.revcx@ 14 @//import/main/checkout.c@ 12 1 
@pv@ 0 @db.desc@ 15 @- support -c and -s to retrieve the module list
- silently accept most of the other options supported by checkout
- do not abandon all hope if the `expand-modules' request fails
@ 
@pv@ 0 @db.change@ 15 15 @svn-client@ @jfb@ 1109110320 1 @- support -c and -s to retrieve@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 13 1 1 15 1109110320 1109110320 00000000000000000000000000000000 @//import/main/checkout.c@ @1.15@ 1 
@pv@ 0 @db.revcx@ 15 @//import/main/checkout.c@ 13 1 
@pv@ 0 @db.desc@ 16 @- support -c and -s to retrieve the module list
- silently accept most of the other options supported by checkout
- do not abandon all hope if the `expand-modules' request fails
@ 
@pv@ 0 @db.change@ 16 16 @svn-client@ @jfb@ 1109110320 1 @- support -c and -s to retrieve@ 
@pv@ 0 @db.integed@ @//import/OPENBSD_3_7/checkout.c@ @//import/main/checkout.c@ 0 13 0 1 2 16 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_3_7/checkout.c@ 0 1 0 13 3 16 
@pv@ 3 @db.rev@ @//import/OPENBSD_3_7/checkout.c@ 1 1 3 16 1109110320 1109110320 00000000000000000000000000000000 @//import/main/checkout.c@ @1.15@ 1 
@pv@ 0 @db.revcx@ 16 @//import/OPENBSD_3_7/checkout.c@ 1 3 
@pv@ 0 @db.desc@ 17 @

move all the client commands to the new command framework.
eliminates a lot of duplicate code.

ok jfb@@
@ 
@pv@ 0 @db.change@ 17 17 @svn-client@ @joris@ 1112204584 1 @

move all the client commands @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 14 1 1 17 1112204584 1112204584 00000000000000000000000000000000 @//import/main/checkout.c@ @1.17@ 1 
@pv@ 0 @db.revcx@ 17 @//import/main/checkout.c@ 14 1 
@pv@ 0 @db.desc@ 18 @first round of EX_* exit codes removal; ok joris@@.
@ 
@pv@ 0 @db.change@ 18 18 @svn-client@ @xsa@ 1112549570 1 @first round of EX_* exit codes @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 15 1 1 18 1112549570 1112549570 00000000000000000000000000000000 @//import/main/checkout.c@ @1.18@ 1 
@pv@ 0 @db.revcx@ 18 @//import/main/checkout.c@ 15 1 
@pv@ 0 @db.desc@ 19 @

remove EX_USAGE error codes

ok jfb@@
@ 
@pv@ 0 @db.change@ 19 19 @svn-client@ @joris@ 1113242187 1 @

remove EX_USAGE error codes

@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 16 1 1 19 1113242187 1113242187 00000000000000000000000000000000 @//import/main/checkout.c@ @1.19@ 1 
@pv@ 0 @db.revcx@ 19 @//import/main/checkout.c@ 16 1 
@pv@ 0 @db.desc@ 20 @

don't include sysexits.h now we don't use those error codes
anymore.
@ 
@pv@ 0 @db.change@ 20 20 @svn-client@ @joris@ 1113242578 1 @

don't include sysexits.h now @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 17 1 1 20 1113242578 1113242578 00000000000000000000000000000000 @//import/main/checkout.c@ @1.20@ 1 
@pv@ 0 @db.revcx@ 20 @//import/main/checkout.c@ 17 1 
@pv@ 0 @db.desc@ 21 @

introduce our own set of error codes used by the commands to report
what exactly went wrong in case of an error.

ok jfb@@
@ 
@pv@ 0 @db.change@ 21 21 @svn-client@ @joris@ 1113317920 1 @

introduce our own set of erro@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 18 1 1 21 1113317920 1113317920 00000000000000000000000000000000 @//import/main/checkout.c@ @1.21@ 1 
@pv@ 0 @db.revcx@ 21 @//import/main/checkout.c@ 18 1 
@pv@ 0 @db.desc@ 22 @

execute the command callback at the same time we are building
the in-memory filelist. cuts down on execution time for larger trees.

"put it in!" jfb@@
@ 
@pv@ 0 @db.change@ 22 22 @svn-client@ @joris@ 1116566024 1 @

execute the command callback @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 19 1 1 22 1116566024 1116566024 00000000000000000000000000000000 @//import/main/checkout.c@ @1.22@ 1 
@pv@ 0 @db.revcx@ 22 @//import/main/checkout.c@ 19 1 
@pv@ 0 @db.desc@ 23 @first bits of the `cvs -n' option; ok jfb joris
@ 
@pv@ 0 @db.change@ 23 23 @svn-client@ @xsa@ 1116613609 1 @first bits of the `cvs -n' opti@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 20 1 1 23 1116613609 1116613609 00000000000000000000000000000000 @//import/main/checkout.c@ @1.23@ 1 
@pv@ 0 @db.revcx@ 23 @//import/main/checkout.c@ 20 1 
@pv@ 0 @db.desc@ 24 @add -f flag; ok joris@@
@ 
@pv@ 0 @db.change@ 24 24 @svn-client@ @xsa@ 1116869435 1 @add -f flag; ok joris@@
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 21 1 1 24 1116869435 1116869435 00000000000000000000000000000000 @//import/main/checkout.c@ @1.24@ 1 
@pv@ 0 @db.revcx@ 24 @//import/main/checkout.c@ 21 1 
@pv@ 0 @db.desc@ 25 @Merge the cvs_cmd and cvs_cmd_info structures and add the necessary
fields to hook local versions of the commands.  This needs to go in
before it gets any bigger

ok joris
@ 
@pv@ 0 @db.change@ 25 25 @svn-client@ @jfb@ 1116907945 1 @Merge the cvs_cmd and cvs_cmd_i@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 22 1 1 25 1116907945 1116907945 00000000000000000000000000000000 @//import/main/checkout.c@ @1.25@ 1 
@pv@ 0 @db.revcx@ 25 @//import/main/checkout.c@ 22 1 
@pv@ 0 @db.desc@ 26 @

- simplify cvs_mkadmin().
- create the correct base paths in checkout.
- remove the CVS_CMD_SENDARGS2 flag for checkout, it doesn't need it.

okay jfb@@
@ 
@pv@ 0 @db.change@ 26 26 @svn-client@ @joris@ 1116965083 1 @

- simplify cvs_mkadmin().
- c@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 23 1 1 26 1116965083 1116965083 00000000000000000000000000000000 @//import/main/checkout.c@ @1.26@ 1 
@pv@ 0 @db.revcx@ 26 @//import/main/checkout.c@ 23 1 
@pv@ 0 @db.desc@ 27 @

first part of real pruning support

okay jfb@@
@ 
@pv@ 0 @db.change@ 27 27 @svn-client@ @joris@ 1117076840 1 @

first part of real pruning su@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 24 1 1 27 1117076840 1117076840 00000000000000000000000000000000 @//import/main/checkout.c@ @1.27@ 1 
@pv@ 0 @db.revcx@ 27 @//import/main/checkout.c@ 24 1 
@pv@ 0 @db.desc@ 28 @-r implies -P (Prune empty directories);
@ 
@pv@ 0 @db.change@ 28 28 @svn-client@ @xsa@ 1117388924 1 @-r implies -P (Prune empty dire@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 25 1 1 28 1117388924 1117388924 00000000000000000000000000000000 @//import/main/checkout.c@ @1.28@ 1 
@pv@ 0 @db.revcx@ 28 @//import/main/checkout.c@ 25 1 
@pv@ 0 @db.desc@ 29 @dont return CVS_EX_USAGE when not needed; ok joris@@
@ 
@pv@ 0 @db.change@ 29 29 @svn-client@ @xsa@ 1117438761 1 @dont return CVS_EX_USAGE when n@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 26 1 1 29 1117438761 1117438761 00000000000000000000000000000000 @//import/main/checkout.c@ @1.29@ 1 
@pv@ 0 @db.revcx@ 29 @//import/main/checkout.c@ 26 1 
@pv@ 0 @db.desc@ 30 @remove LP_ERROR log priority level and rather use LP_ERR as they are both
the same...

ok jfb joris
@ 
@pv@ 0 @db.change@ 30 30 @svn-client@ @xsa@ 1117528000 1 @remove LP_ERROR log priority le@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 27 1 1 30 1117528000 1117528000 00000000000000000000000000000000 @//import/main/checkout.c@ @1.30@ 1 
@pv@ 0 @db.revcx@ 30 @//import/main/checkout.c@ 27 1 
@pv@ 0 @db.desc@ 31 @headers ordering (alphabetically) and cleanup, from mbalmer@@ and myself;
@ 
@pv@ 0 @db.change@ 31 31 @svn-client@ @xsa@ 1117529927 1 @headers ordering (alphabeticall@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 28 1 1 31 1117529927 1117529927 00000000000000000000000000000000 @//import/main/checkout.c@ @1.31@ 1 
@pv@ 0 @db.revcx@ 31 @//import/main/checkout.c@ 28 1 
@pv@ 0 @db.desc@ 32 @enable -P option .. joris@@ ok
@ 
@pv@ 0 @db.change@ 32 32 @svn-client@ @xsa@ 1118157205 1 @enable -P option .. joris@@ ok
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 29 1 1 32 1118157205 1118157205 00000000000000000000000000000000 @//import/main/checkout.c@ @1.32@ 1 
@pv@ 0 @db.revcx@ 32 @//import/main/checkout.c@ 29 1 
@pv@ 0 @db.desc@ 33 @silly me. do not abuse the copy/paste skills i have ...
@ 
@pv@ 0 @db.change@ 33 33 @svn-client@ @xsa@ 1118158464 1 @silly me. do not abuse the copy@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 30 1 1 33 1118158464 1118158464 00000000000000000000000000000000 @//import/main/checkout.c@ @1.33@ 1 
@pv@ 0 @db.revcx@ 33 @//import/main/checkout.c@ 30 1 
@pv@ 0 @db.desc@ 34 @LP_ERR -> LP_ABORT to match gnu/usr.bin/cvs output; okay joris@@.
@ 
@pv@ 0 @db.change@ 34 34 @svn-client@ @xsa@ 1118301879 1 @LP_ERR -> LP_ABORT to match gnu@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 31 1 1 34 1118301879 1118301879 00000000000000000000000000000000 @//import/main/checkout.c@ @1.34@ 1 
@pv@ 0 @db.revcx@ 34 @//import/main/checkout.c@ 31 1 
@pv@ 0 @db.desc@ 35 @-D implies pruning directories, as already does -r; ok joris
@ 
@pv@ 0 @db.change@ 35 35 @svn-client@ @xsa@ 1118307710 1 @-D implies pruning directories,@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 32 1 1 35 1118307710 1118307710 00000000000000000000000000000000 @//import/main/checkout.c@ @1.35@ 1 
@pv@ 0 @db.revcx@ 35 @//import/main/checkout.c@ 32 1 
@pv@ 0 @db.desc@ 36 @`export' command first bits .. ok joris
@ 
@pv@ 0 @db.change@ 36 36 @svn-client@ @xsa@ 1118648439 1 @`export' command first bits .. @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 33 1 1 36 1118648439 1118648439 00000000000000000000000000000000 @//import/main/checkout.c@ @1.36@ 1 
@pv@ 0 @db.revcx@ 36 @//import/main/checkout.c@ 33 1 
@pv@ 0 @db.desc@ 37 @send date;
@ 
@pv@ 0 @db.change@ 37 37 @svn-client@ @xsa@ 1119948894 1 @send date;
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 34 1 1 37 1119948894 1119948894 00000000000000000000000000000000 @//import/main/checkout.c@ @1.37@ 1 
@pv@ 0 @db.revcx@ 37 @//import/main/checkout.c@ 34 1 
@pv@ 0 @db.desc@ 38 @

remove trailing whitespaces

from deraadt@@
@ 
@pv@ 0 @db.change@ 38 38 @svn-client@ @joris@ 1120746477 1 @

remove trailing whitespaces

@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 35 1 1 38 1120746477 1120746477 00000000000000000000000000000000 @//import/main/checkout.c@ @1.38@ 1 
@pv@ 0 @db.revcx@ 38 @//import/main/checkout.c@ 35 1 
@pv@ 0 @db.desc@ 39 @

do not send the Arguments to the server twice.

ok xsa@@
@ 
@pv@ 0 @db.change@ 39 39 @svn-client@ @joris@ 1120811049 1 @

do not send the Arguments to @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 36 1 1 39 1120811049 1120811049 00000000000000000000000000000000 @//import/main/checkout.c@ @1.39@ 1 
@pv@ 0 @db.revcx@ 39 @//import/main/checkout.c@ 36 1 
@pv@ 0 @db.desc@ 40 @

- revert previous commit a bit, those arguments belonged to expand-modules.
- send -N by default, to match GNU's behaviour.

ok xsa@@
@ 
@pv@ 0 @db.change@ 40 40 @svn-client@ @joris@ 1120812883 1 @

- revert previous commit a bi@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 37 1 1 40 1120812883 1120812883 00000000000000000000000000000000 @//import/main/checkout.c@ @1.40@ 1 
@pv@ 0 @db.revcx@ 40 @//import/main/checkout.c@ 37 1 
@pv@ 0 @db.desc@ 41 @some more `if (!var)' cleanup;
@ 
@pv@ 0 @db.change@ 41 41 @svn-client@ @xsa@ 1122227285 1 @some more `if (!var)' cleanup;
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 38 1 1 41 1122227285 1122227285 00000000000000000000000000000000 @//import/main/checkout.c@ @1.41@ 1 
@pv@ 0 @db.revcx@ 41 @//import/main/checkout.c@ 38 1 
@pv@ 0 @db.desc@ 42 @KNF;
@ 
@pv@ 0 @db.change@ 42 42 @svn-client@ @xsa@ 1122293143 1 @KNF;
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 39 1 1 42 1122293143 1122293143 00000000000000000000000000000000 @//import/main/checkout.c@ @1.42@ 1 
@pv@ 0 @db.revcx@ 42 @//import/main/checkout.c@ 39 1 
@pv@ 0 @db.desc@ 43 @KNF;
@ 
@pv@ 0 @db.change@ 43 43 @svn-client@ @xsa@ 1122293143 1 @KNF;
@ 
@pv@ 0 @db.integed@ @//import/OPENBSD_3_8/checkout.c@ @//import/main/checkout.c@ 0 39 0 1 2 43 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_3_8/checkout.c@ 0 1 0 39 3 43 
@pv@ 3 @db.rev@ @//import/OPENBSD_3_8/checkout.c@ 1 1 3 43 1122293143 1122293143 00000000000000000000000000000000 @//import/main/checkout.c@ @1.42@ 1 
@pv@ 0 @db.revcx@ 43 @//import/OPENBSD_3_8/checkout.c@ 1 3 
@pv@ 0 @db.desc@ 44 @check in cvs_mkadmin() wether we need to create or not the
CVS/Tag file. Sync the rest of the code accordingly; OK joris@@.
@ 
@pv@ 0 @db.change@ 44 44 @svn-client@ @xsa@ 1126803670 1 @check in cvs_mkadmin() wether w@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 40 1 1 44 1126803670 1126803670 00000000000000000000000000000000 @//import/main/checkout.c@ @1.44@ 1 
@pv@ 0 @db.revcx@ 44 @//import/main/checkout.c@ 40 1 
@pv@ 0 @db.desc@ 45 @add very basic support for the following stuff:

- checkout in local mode (example: /cvs)
- update in local and server mode (example: /cvs and user@@host:/cvs)
- import in local and server mode (example: /cvs and user@@host:/cvs)

what remains to be done:

- not all options are supported yet, and update cannot pick up newly
  added files yet. these things are pending and will be commited
  real soon.

- checkout only works locally right now.

- fix rcs parsing code so that we don't fucking hog 100% cpu
  on really BIG BIG BIG ass trees.

mainly tested by pedro@@ and myself, thanks a lot pedro!

"go for it" niallo@@
@ 
@pv@ 0 @db.change@ 45 45 @svn-client@ @joris@ 1133571728 1 @add very basic support for the @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 41 1 1 45 1133571728 1133571728 00000000000000000000000000000000 @//import/main/checkout.c@ @1.45@ 1 
@pv@ 0 @db.revcx@ 45 @//import/main/checkout.c@ 41 1 
@pv@ 0 @db.desc@ 46 @major cleanup of the functions handling the remote cvs protocol.
makes the code a lot more readable and understandable.

ok xsa@@ and niallo@@
@ 
@pv@ 0 @db.change@ 46 46 @svn-client@ @joris@ 1135908208 1 @major cleanup of the functions @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 42 1 1 46 1135908208 1135908208 00000000000000000000000000000000 @//import/main/checkout.c@ @1.46@ 1 
@pv@ 0 @db.revcx@ 46 @//import/main/checkout.c@ 42 1 
@pv@ 0 @db.desc@ 47 @knf
@ 
@pv@ 0 @db.change@ 47 47 @svn-client@ @reyk@ 1135965061 1 @knf
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 43 1 1 47 1135965061 1135965061 00000000000000000000000000000000 @//import/main/checkout.c@ @1.47@ 1 
@pv@ 0 @db.revcx@ 47 @//import/main/checkout.c@ 43 1 
@pv@ 0 @db.desc@ 48 @#include's cleanup; ok joris@@ niallo@@.
@ 
@pv@ 0 @db.change@ 48 48 @svn-client@ @xsa@ 1136189516 1 @#include's cleanup; ok joris@@ n@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 44 1 1 48 1136189516 1136189516 00000000000000000000000000000000 @//import/main/checkout.c@ @1.48@ 1 
@pv@ 0 @db.revcx@ 48 @//import/main/checkout.c@ 44 1 
@pv@ 0 @db.desc@ 49 @use cvs_rcs_getpath() here too + some strings cleanup whilst here.
@ 
@pv@ 0 @db.change@ 49 49 @svn-client@ @xsa@ 1138191373 1 @use cvs_rcs_getpath() here too @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 45 1 1 49 1138191373 1138191373 00000000000000000000000000000000 @//import/main/checkout.c@ @1.49@ 1 
@pv@ 0 @db.revcx@ 49 @//import/main/checkout.c@ 45 1 
@pv@ 0 @db.desc@ 50 @errors handling cleaning here too;
@ 
@pv@ 0 @db.change@ 50 50 @svn-client@ @xsa@ 1138359203 1 @errors handling cleaning here t@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 46 1 1 50 1138359203 1138359203 00000000000000000000000000000000 @//import/main/checkout.c@ @1.50@ 1 
@pv@ 0 @db.revcx@ 50 @//import/main/checkout.c@ 46 1 
@pv@ 0 @db.desc@ 51 @errors handling cleaning here too;
@ 
@pv@ 0 @db.change@ 51 51 @svn-client@ @xsa@ 1138365921 1 @errors handling cleaning here t@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 47 1 1 51 1138365921 1138365921 00000000000000000000000000000000 @//import/main/checkout.c@ @1.51@ 1 
@pv@ 0 @db.revcx@ 51 @//import/main/checkout.c@ 47 1 
@pv@ 0 @db.desc@ 52 @cvs_mkadmin() cannot return < 0 anymore;
@ 
@pv@ 0 @db.change@ 52 52 @svn-client@ @xsa@ 1138366588 1 @cvs_mkadmin() cannot return < 0@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 48 1 1 52 1138366588 1138366588 00000000000000000000000000000000 @//import/main/checkout.c@ @1.52@ 1 
@pv@ 0 @db.revcx@ 52 @//import/main/checkout.c@ 48 1 
@pv@ 0 @db.desc@ 53 @strerror() -> rcs_errstr() when passing rcs_errno as argument;
@ 
@pv@ 0 @db.change@ 53 53 @svn-client@ @xsa@ 1138643927 1 @strerror() -> rcs_errstr() when@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 49 1 1 53 1138643927 1138643927 00000000000000000000000000000000 @//import/main/checkout.c@ @1.53@ 1 
@pv@ 0 @db.revcx@ 53 @//import/main/checkout.c@ 49 1 
@pv@ 0 @db.desc@ 54 @errors in cvs_checkout_init() are definitly fatal.
@ 
@pv@ 0 @db.change@ 54 54 @svn-client@ @xsa@ 1138715720 1 @errors in cvs_checkout_init() a@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 50 1 1 54 1138715720 1138715720 00000000000000000000000000000000 @//import/main/checkout.c@ @1.54@ 1 
@pv@ 0 @db.revcx@ 54 @//import/main/checkout.c@ 50 1 
@pv@ 0 @db.desc@ 55 @errors in cvs_checkout_init() are definitly fatal.
@ 
@pv@ 0 @db.change@ 55 55 @svn-client@ @xsa@ 1138715720 1 @errors in cvs_checkout_init() a@ 
@pv@ 0 @db.integed@ @//import/OPENBSD_3_9/checkout.c@ @//import/main/checkout.c@ 0 50 0 1 2 55 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_3_9/checkout.c@ 0 1 0 50 3 55 
@pv@ 3 @db.rev@ @//import/OPENBSD_3_9/checkout.c@ 1 1 3 55 1138715720 1138715720 00000000000000000000000000000000 @//import/main/checkout.c@ @1.54@ 1 
@pv@ 0 @db.revcx@ 55 @//import/OPENBSD_3_9/checkout.c@ 1 3 
@pv@ 0 @db.desc@ 56 @Remove unused variables, better integer types, prevent fallthroughs.
Found by lint.

Compare char * variables against NULL for consistency and add
parentheses around complicated comparisons, suggested by xsa@@.

OK xsa@@
@ 
@pv@ 0 @db.change@ 56 56 @svn-client@ @ray@ 1143207267 1 @Remove unused variables, better@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 51 1 1 56 1143207267 1143207267 00000000000000000000000000000000 @//import/main/checkout.c@ @1.56@ 1 
@pv@ 0 @db.revcx@ 56 @//import/main/checkout.c@ 51 1 
@pv@ 0 @db.desc@ 57 @remove a metric buttload of excessive ()
no binary change; ok ray
@ 
@pv@ 0 @db.change@ 57 57 @svn-client@ @deraadt@ 1144982735 1 @remove a metric buttload of exc@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 52 1 1 57 1144982735 1144982735 00000000000000000000000000000000 @//import/main/checkout.c@ @1.57@ 1 
@pv@ 0 @db.revcx@ 57 @//import/main/checkout.c@ 52 1 
@pv@ 0 @db.desc@ 58 @commit the new opencvs code, i have been hacking on
this for the past 2 weeks now and it should go in at
the start of the hackathon so others can help out.

this code is a lot safer, smarter, faster and best of
all it is actually doing what it is suppose to do!

basic checkout, update, status, diff and commit are
working in local mode only.
there is no support for any remote setups now.
@ 
@pv@ 0 @db.change@ 58 58 @svn-client@ @joris@ 1148700630 1 @commit the new opencvs code, i @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 53 1 1 58 1148700630 1148700630 00000000000000000000000000000000 @//import/main/checkout.c@ @1.58@ 1 
@pv@ 0 @db.revcx@ 58 @//import/main/checkout.c@ 53 1 
@pv@ 0 @db.desc@ 59 @pruning (-P) support for both the update and checkout commands;
@ 
@pv@ 0 @db.change@ 59 59 @svn-client@ @joris@ 1148707225 1 @pruning (-P) support for both t@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 54 1 1 59 1148707225 1148707225 00000000000000000000000000000000 @//import/main/checkout.c@ @1.59@ 1 
@pv@ 0 @db.revcx@ 59 @//import/main/checkout.c@ 54 1 
@pv@ 0 @db.desc@ 60 @correctly expand keywords when checking out files
@ 
@pv@ 0 @db.change@ 60 60 @svn-client@ @joris@ 1148709572 1 @correctly expand keywords when @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 55 1 1 60 1148709572 1148709572 00000000000000000000000000000000 @//import/main/checkout.c@ @1.60@ 1 
@pv@ 0 @db.revcx@ 60 @//import/main/checkout.c@ 55 1 
@pv@ 0 @db.desc@ 61 @allow commands to respect the -l flag, if the -l flag is
specified certain commands will not recurse into directories.

at the same time introduce a method of specifying wether or not
a command should look in the repository for files.
@ 
@pv@ 0 @db.change@ 61 61 @svn-client@ @joris@ 1148742867 1 @allow commands to respect the -@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 56 1 1 61 1148742867 1148742867 00000000000000000000000000000000 @//import/main/checkout.c@ @1.61@ 1 
@pv@ 0 @db.revcx@ 61 @//import/main/checkout.c@ 56 1 
@pv@ 0 @db.desc@ 62 @support the -d flag for update.

if you specify -d when running update new directories will be build,
otherwise they will be skipped.
@ 
@pv@ 0 @db.change@ 62 62 @svn-client@ @joris@ 1148746201 1 @support the -d flag for update.@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 57 1 1 62 1148746201 1148746201 00000000000000000000000000000000 @//import/main/checkout.c@ @1.62@ 1 
@pv@ 0 @db.revcx@ 62 @//import/main/checkout.c@ 57 1 
@pv@ 0 @db.desc@ 63 @enable merging on update. if your file in your working copy
has been modified by yourself and there is a newer revision
we try and merge them together.

if the merge fails and has conflicts it will mark them inside
the file, you will need to resolve these by hand first before
you will be able to commit your modified file.

works transparent with gnu cvs, as it is suppose to.
@ 
@pv@ 0 @db.change@ 63 63 @svn-client@ @joris@ 1148779468 1 @enable merging on update. if yo@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 58 1 1 63 1148779468 1148779468 00000000000000000000000000000000 @//import/main/checkout.c@ @1.63@ 1 
@pv@ 0 @db.revcx@ 63 @//import/main/checkout.c@ 58 1 
@pv@ 0 @db.desc@ 64 @add support for the export command.

export does exactly the same as checkout except it does
not create any administrative (CVS/) directories.
@ 
@pv@ 0 @db.change@ 64 64 @svn-client@ @joris@ 1149114359 1 @add support for the export comm@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 59 1 1 64 1149114359 1149114359 00000000000000000000000000000000 @//import/main/checkout.c@ @1.64@ 1 
@pv@ 0 @db.revcx@ 64 @//import/main/checkout.c@ 59 1 
@pv@ 0 @db.desc@ 65 @add support for update -A and update -r<rev>.
hacking on the plane from toronto to barbados.

i will probably hack some more since im stuck in barbados
for 12 lovely hours over night cause the carribean airlines dont understand
the meaning over 'more than one flight a day'.
@ 
@pv@ 0 @db.change@ 65 65 @svn-client@ @joris@ 1149361633 1 @add support for update -A and u@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 60 1 1 65 1149361633 1149361633 00000000000000000000000000000000 @//import/main/checkout.c@ @1.65@ 1 
@pv@ 0 @db.revcx@ 65 @//import/main/checkout.c@ 60 1 
@pv@ 0 @db.desc@ 66 @more bits for the export command to work correctly. OK joris@@.
@ 
@pv@ 0 @db.change@ 66 66 @svn-client@ @xsa@ 1149577126 1 @more bits for the export comman@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 61 1 1 66 1149577126 1149577126 00000000000000000000000000000000 @//import/main/checkout.c@ @1.66@ 1 
@pv@ 0 @db.revcx@ 66 @//import/main/checkout.c@ 61 1 
@pv@ 0 @db.desc@ 67 @simplify cvs_hack_time() and the way it is called;
@ 
@pv@ 0 @db.change@ 67 67 @svn-client@ @joris@ 1150316933 1 @simplify cvs_hack_time() and th@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 62 1 1 67 1150316933 1150316933 00000000000000000000000000000000 @//import/main/checkout.c@ @1.67@ 1 
@pv@ 0 @db.revcx@ 67 @//import/main/checkout.c@ 62 1 
@pv@ 0 @db.desc@ 68 @in preparation for the new remote code, proto.h becomes obsolete.
@ 
@pv@ 0 @db.change@ 68 68 @svn-client@ @joris@ 1150466862 1 @in preparation for the new remo@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 63 1 1 68 1150466862 1150466862 00000000000000000000000000000000 @//import/main/checkout.c@ @1.68@ 1 
@pv@ 0 @db.revcx@ 68 @//import/main/checkout.c@ 63 1 
@pv@ 0 @db.desc@ 69 @kill local and remote callback and just have one called fileproc.
we let the commands pass the correct function.

all in preparation for remote.
@ 
@pv@ 0 @db.change@ 69 69 @svn-client@ @joris@ 1150693517 1 @kill local and remote callback @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 64 1 1 69 1150693517 1150693517 00000000000000000000000000000000 @//import/main/checkout.c@ @1.69@ 1 
@pv@ 0 @db.revcx@ 69 @//import/main/checkout.c@ 64 1 
@pv@ 0 @db.desc@ 70 @implement the -p (dump) flag for cvs update

ok joris@@
@ 
@pv@ 0 @db.change@ 70 70 @svn-client@ @reyk@ 1151785846 1 @implement the -p (dump) flag fo@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 65 1 1 70 1151785846 1151785846 00000000000000000000000000000000 @//import/main/checkout.c@ @1.70@ 1 
@pv@ 0 @db.revcx@ 70 @//import/main/checkout.c@ 65 1 
@pv@ 0 @db.desc@ 71 @first part of opencvs remote, fairly useable on existing trees
although i advise against using it on real development trees for now.

only a few commands work right so far:
- commit
- diff
- status
- log
- update (partially working)

if you feel like testing remote and run into bugs feel free to
contact me, and please include a full trace (-t).
@ 
@pv@ 0 @db.change@ 71 71 @svn-client@ @joris@ 1152293837 1 @first part of opencvs remote, f@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 66 1 1 71 1152293837 1152293837 00000000000000000000000000000000 @//import/main/checkout.c@ @1.71@ 1 
@pv@ 0 @db.revcx@ 71 @//import/main/checkout.c@ 66 1 
@pv@ 0 @db.desc@ 72 @first part of opencvs remote, fairly useable on existing trees
although i advise against using it on real development trees for now.

only a few commands work right so far:
- commit
- diff
- status
- log
- update (partially working)

if you feel like testing remote and run into bugs feel free to
contact me, and please include a full trace (-t).
@ 
@pv@ 0 @db.change@ 72 72 @svn-client@ @joris@ 1152293837 1 @first part of opencvs remote, f@ 
@pv@ 0 @db.integed@ @//import/OPENBSD_4_0/checkout.c@ @//import/main/checkout.c@ 0 66 0 1 2 72 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_4_0/checkout.c@ 0 1 0 66 3 72 
@pv@ 3 @db.rev@ @//import/OPENBSD_4_0/checkout.c@ 1 1 3 72 1152293837 1152293837 00000000000000000000000000000000 @//import/main/checkout.c@ @1.71@ 1 
@pv@ 0 @db.revcx@ 72 @//import/OPENBSD_4_0/checkout.c@ 1 3 
@pv@ 0 @db.desc@ 73 @snprintf() -> cvs_path_cat();
@ 
@pv@ 0 @db.change@ 73 73 @svn-client@ @xsa@ 1166788310 1 @snprintf() -> cvs_path_cat();
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 67 1 1 73 1166788310 1166788310 00000000000000000000000000000000 @//import/main/checkout.c@ @1.73@ 1 
@pv@ 0 @db.revcx@ 73 @//import/main/checkout.c@ 67 1 
@pv@ 0 @db.desc@ 74 @if we are commiting a file, do not let the server resend it
with an 'Updated' response, seeing as the client will already have the
latest version. Instead, send the correct 'Checked-in' response.
@ 
@pv@ 0 @db.change@ 74 74 @svn-client@ @joris@ 1167857306 1 @if we are commiting a file, do @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 68 1 1 74 1167857306 1167857306 00000000000000000000000000000000 @//import/main/checkout.c@ @1.74@ 1 
@pv@ 0 @db.revcx@ 74 @//import/main/checkout.c@ 68 1 
@pv@ 0 @db.desc@ 75 @add support for 'remove' in a remote setup.
testing appriciated, as always.
@ 
@pv@ 0 @db.change@ 75 75 @svn-client@ @joris@ 1167863310 1 @add support for 'remove' in a r@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 69 1 1 75 1167863310 1167863310 00000000000000000000000000000000 @//import/main/checkout.c@ @1.75@ 1 
@pv@ 0 @db.revcx@ 75 @//import/main/checkout.c@ 69 1 
@pv@ 0 @db.desc@ 76 @major re-work of the RCS api.  this results in 100x performance improvements in some places and much
reduced memory usage.  note that only checkout has been fully converted to use the new high-performance
functions.  other codepaths (e.g. update) still use the old method which is provided for backwards
compatibility.  we can convert the remaining slow bits over to the new api piece-by-piece.

"commit this, now" joris@@
brad@@ tested, too.
@ 
@pv@ 0 @db.change@ 76 76 @svn-client@ @niallo@ 1168644721 1 @major re-work of the RCS api.  @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 70 1 1 76 1168644721 1168644721 00000000000000000000000000000000 @//import/main/checkout.c@ @1.76@ 1 
@pv@ 0 @db.revcx@ 76 @//import/main/checkout.c@ 70 1 
@pv@ 0 @db.desc@ 77 @simplify after recent rcs API changes.
kay niallo@@
@ 
@pv@ 0 @db.change@ 77 77 @svn-client@ @joris@ 1168646171 1 @simplify after recent rcs API c@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 71 1 1 77 1168646171 1168646171 00000000000000000000000000000000 @//import/main/checkout.c@ @1.77@ 1 
@pv@ 0 @db.revcx@ 77 @//import/main/checkout.c@ 71 1 
@pv@ 0 @db.desc@ 78 @- remote update now works again, with new rcs api
- we no longer hold the entire file in memory when sending or receiving it
@ 
@pv@ 0 @db.change@ 78 78 @svn-client@ @joris@ 1168702174 1 @- remote update now works again@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 72 1 1 78 1168702174 1168702174 00000000000000000000000000000000 @//import/main/checkout.c@ @1.78@ 1 
@pv@ 0 @db.revcx@ 78 @//import/main/checkout.c@ 72 1 
@pv@ 0 @db.desc@ 79 @remove BUF * argument from cvs_checkout_file() it will
no longer be used, ever.
@ 
@pv@ 0 @db.change@ 79 79 @svn-client@ @joris@ 1168703159 1 @remove BUF * argument from cvs_@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 73 1 1 79 1168703159 1168703159 00000000000000000000000000000000 @//import/main/checkout.c@ @1.79@ 1 
@pv@ 0 @db.revcx@ 79 @//import/main/checkout.c@ 73 1 
@pv@ 0 @db.desc@ 80 @plug 3 memleaks
@ 
@pv@ 0 @db.change@ 80 80 @svn-client@ @joris@ 1168703775 1 @plug 3 memleaks
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 74 1 1 80 1168703775 1168703775 00000000000000000000000000000000 @//import/main/checkout.c@ @1.80@ 1 
@pv@ 0 @db.revcx@ 80 @//import/main/checkout.c@ 74 1 
@pv@ 0 @db.desc@ 81 @replace checkout_write_revision() with rcs_rev_write_stmp()
they do exactly the same anyway.
@ 
@pv@ 0 @db.change@ 81 81 @svn-client@ @joris@ 1168800295 1 @replace checkout_write_revision@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 75 1 1 81 1168800295 1168800295 00000000000000000000000000000000 @//import/main/checkout.c@ @1.81@ 1 
@pv@ 0 @db.revcx@ 81 @//import/main/checkout.c@ 75 1 
@pv@ 0 @db.desc@ 82 @reset sticky tags with -A; OK joris@@.
@ 
@pv@ 0 @db.change@ 82 82 @svn-client@ @xsa@ 1168813246 1 @reset sticky tags with -A; OK j@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 76 1 1 82 1168813246 1168813246 00000000000000000000000000000000 @//import/main/checkout.c@ @1.82@ 1 
@pv@ 0 @db.revcx@ 82 @//import/main/checkout.c@ 76 1 
@pv@ 0 @db.desc@ 83 @handle -l and -R for checkout too.
@ 
@pv@ 0 @db.change@ 83 83 @svn-client@ @xsa@ 1168935447 1 @handle -l and -R for checkout t@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 77 1 1 83 1168935447 1168935447 00000000000000000000000000000000 @//import/main/checkout.c@ @1.83@ 1 
@pv@ 0 @db.revcx@ 83 @//import/main/checkout.c@ 77 1 
@pv@ 0 @db.desc@ 84 @better, share -l and -R flags between checkout and export cmds.
@ 
@pv@ 0 @db.change@ 84 84 @svn-client@ @xsa@ 1168936426 1 @better, share -l and -R flags b@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 78 1 1 84 1168936426 1168936426 00000000000000000000000000000000 @//import/main/checkout.c@ @1.84@ 1 
@pv@ 0 @db.revcx@ 84 @//import/main/checkout.c@ 78 1 
@pv@ 0 @db.desc@ 85 @add support for remote checkout in both our client and server,
with this the last real dependency to actually be able to use opencvs
in a remote setup has been added.

based upon an initial diff from xsa@@
'kay niallo@@
@ 
@pv@ 0 @db.change@ 85 85 @svn-client@ @joris@ 1169056490 1 @add support for remote checkout@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 79 1 1 85 1169056490 1169056490 00000000000000000000000000000000 @//import/main/checkout.c@ @1.85@ 1 
@pv@ 0 @db.revcx@ 85 @//import/main/checkout.c@ 79 1 
@pv@ 0 @db.desc@ 86 @send -l Argument to server when appropriate.
@ 
@pv@ 0 @db.change@ 86 86 @svn-client@ @xsa@ 1169066330 1 @send -l Argument to server when@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 80 1 1 86 1169066330 1169066330 00000000000000000000000000000000 @//import/main/checkout.c@ @1.86@ 1 
@pv@ 0 @db.revcx@ 86 @//import/main/checkout.c@ 80 1 
@pv@ 0 @db.desc@ 87 @on checkout, only create the module path if we find the module.
Also make error ouput match GNU CVS.

ok joris@@
@ 
@pv@ 0 @db.change@ 87 87 @svn-client@ @thib@ 1169073590 1 @on checkout, only create the mo@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 81 1 1 87 1169073590 1169073590 00000000000000000000000000000000 @//import/main/checkout.c@ @1.87@ 1 
@pv@ 0 @db.revcx@ 87 @//import/main/checkout.c@ 81 1 
@pv@ 0 @db.desc@ 88 @put functions protos at the right place.
@ 
@pv@ 0 @db.change@ 88 88 @svn-client@ @xsa@ 1169110148 1 @put functions protos at the rig@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 82 1 1 88 1169110148 1169110148 00000000000000000000000000000000 @//import/main/checkout.c@ @1.88@ 1 
@pv@ 0 @db.revcx@ 88 @//import/main/checkout.c@ 82 1 
@pv@ 0 @db.desc@ 89 @when acting as a server - immediatly after we checkout a file
remove its temp copy so our worklist doesnt contain a
bazillion entries when checking out src.

as a result, we now use very little memory in server mode.

found and tested by otto@@
ok cool and the gang.
@ 
@pv@ 0 @db.change@ 89 89 @svn-client@ @joris@ 1169767352 1 @when acting as a server - immed@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 83 1 1 89 1169767352 1169767352 00000000000000000000000000000000 @//import/main/checkout.c@ @1.89@ 1 
@pv@ 0 @db.revcx@ 89 @//import/main/checkout.c@ 83 1 
@pv@ 0 @db.desc@ 90 @Handle CVS/Entries and file timestamp correctly so we do
not mistakenly see a file as Modified while it is not.

As a result, we can remove the very hackish cvs_hack_time() and
GNU cvs and opencvs should almost get along now.

lotsa help and okay The otto@@
@ 
@pv@ 0 @db.change@ 90 90 @svn-client@ @joris@ 1169810384 1 @Handle CVS/Entries and file tim@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 84 1 1 90 1169810384 1169810384 00000000000000000000000000000000 @//import/main/checkout.c@ @1.90@ 1 
@pv@ 0 @db.revcx@ 90 @//import/main/checkout.c@ 84 1 
@pv@ 0 @db.desc@ 91 @- support [-k mode] for the add command
- do not let the file keyword expension options (-k) disappear
from the Entries file when doing a commit/update/checkout
- be sure the expension mode gets written to the RCS file when a file
is added/committed in the first place
problems raised by otto@@; tests/ok otto@@ and joris@@.
@ 
@pv@ 0 @db.change@ 91 91 @svn-client@ @xsa@ 1169848097 1 @- support [-k mode] for the add@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 85 1 1 91 1169848097 1169848097 00000000000000000000000000000000 @//import/main/checkout.c@ @1.91@ 1 
@pv@ 0 @db.revcx@ 91 @//import/main/checkout.c@ 85 1 
@pv@ 0 @db.desc@ 92 @more fixe size buffers on the stack. ok xsa@@ joris@@
@ 
@pv@ 0 @db.change@ 92 92 @svn-client@ @otto@ 1169848751 1 @more fixe size buffers on the s@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 86 1 1 92 1169848751 1169848751 00000000000000000000000000000000 @//import/main/checkout.c@ @1.92@ 1 
@pv@ 0 @db.revcx@ 92 @//import/main/checkout.c@ 86 1 
@pv@ 0 @db.desc@ 93 @add merging support in both local and remote sides.
tested by many, thanks.
@ 
@pv@ 0 @db.change@ 93 93 @svn-client@ @joris@ 1169949885 1 @add merging support in both loc@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 87 1 1 93 1169949885 1169949885 00000000000000000000000000000000 @//import/main/checkout.c@ @1.93@ 1 
@pv@ 0 @db.revcx@ 93 @//import/main/checkout.c@ 87 1 
@pv@ 0 @db.desc@ 94 @hey look, i found another debug printf from my merging stuff!
kill-zap-nuke-remove-delete it.
@ 
@pv@ 0 @db.change@ 94 94 @svn-client@ @joris@ 1170027582 1 @hey look, i found another debug@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 88 1 1 94 1170027582 1170027582 00000000000000000000000000000000 @//import/main/checkout.c@ @1.94@ 1 
@pv@ 0 @db.revcx@ 94 @//import/main/checkout.c@ 88 1 
@pv@ 0 @db.desc@ 95 @snprintf() -> xsnprintf()
@ 
@pv@ 0 @db.change@ 95 95 @svn-client@ @xsa@ 1170277655 1 @snprintf() -> xsnprintf()
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 89 1 1 95 1170277655 1170277655 00000000000000000000000000000000 @//import/main/checkout.c@ @1.95@ 1 
@pv@ 0 @db.revcx@ 95 @//import/main/checkout.c@ 89 1 
@pv@ 0 @db.desc@ 96 @cvs_path_cat() removal since we can now easily handle that
functionality w/ xsnprintf(); Initial diff started by thib@@.
OK thib@@ joris@@.
@ 
@pv@ 0 @db.change@ 96 96 @svn-client@ @xsa@ 1171736623 1 @cvs_path_cat() removal since we@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 90 1 1 96 1171736623 1171736623 00000000000000000000000000000000 @//import/main/checkout.c@ @1.96@ 1 
@pv@ 0 @db.revcx@ 96 @//import/main/checkout.c@ 90 1 
@pv@ 0 @db.desc@ 97 @an erroneous free() crept in due to a merge error
@ 
@pv@ 0 @db.change@ 97 97 @svn-client@ @otto@ 1171794645 1 @an erroneous free() crept in du@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 91 1 1 97 1171794645 1171794645 00000000000000000000000000000000 @//import/main/checkout.c@ @1.97@ 1 
@pv@ 0 @db.revcx@ 97 @//import/main/checkout.c@ 91 1 
@pv@ 0 @db.desc@ 98 @general includes cleanup sweep. ok joris@@ niallo@@
@ 
@pv@ 0 @db.change@ 98 98 @svn-client@ @otto@ 1172126529 1 @general includes cleanup sweep.@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 92 1 1 98 1172126529 1172126529 00000000000000000000000000000000 @//import/main/checkout.c@ @1.98@ 1 
@pv@ 0 @db.revcx@ 98 @//import/main/checkout.c@ 92 1 
@pv@ 0 @db.desc@ 99 @general includes cleanup sweep. ok joris@@ niallo@@
@ 
@pv@ 0 @db.change@ 99 99 @svn-client@ @otto@ 1172126529 1 @general includes cleanup sweep.@ 
@pv@ 0 @db.integed@ @//import/OPENBSD_4_1/checkout.c@ @//import/main/checkout.c@ 0 92 0 1 2 99 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_4_1/checkout.c@ 0 1 0 92 3 99 
@pv@ 3 @db.rev@ @//import/OPENBSD_4_1/checkout.c@ 1 1 3 99 1172126529 1172126529 00000000000000000000000000000000 @//import/main/checkout.c@ @1.98@ 1 
@pv@ 0 @db.revcx@ 99 @//import/OPENBSD_4_1/checkout.c@ 1 3 
@pv@ 0 @db.desc@ 100 @add support for local and remote branch checkout.  for example,
cvs co -rOPENBSD_3_0 works now.
along the way, simplify and rationalise code and fix a few nits.

ok joris@@ xsa@@ ray@@
@ 
@pv@ 0 @db.change@ 100 100 @svn-client@ @niallo@ 1180720067 1 @add support for local and remot@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 93 1 1 100 1180720067 1180720067 00000000000000000000000000000000 @//import/main/checkout.c@ @1.100@ 1 
@pv@ 0 @db.revcx@ 100 @//import/main/checkout.c@ 93 1 
@pv@ 0 @db.desc@ 101 @first stab at history stuff for opencvs, currently only writes
to CVSROOT/history but cannot parse it yet with the 'history' command.

"Commit it." ray@@
@ 
@pv@ 0 @db.change@ 101 101 @svn-client@ @joris@ 1182189253 1 @first stab at history stuff for@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 94 1 1 101 1182189253 1182189253 00000000000000000000000000000000 @//import/main/checkout.c@ @1.101@ 1 
@pv@ 0 @db.revcx@ 101 @//import/main/checkout.c@ 94 1 
@pv@ 0 @db.desc@ 102 @We were missing the needed clue/magic to have our remote setup
handle files that have been removed from the repository
correctly, which resulted in them still being in the working copy
after doing an update.

noticed and diff tested by ckuethe@@.
@ 
@pv@ 0 @db.change@ 102 102 @svn-client@ @joris@ 1182916696 1 @We were missing the needed clue@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 95 1 1 102 1182916696 1182916696 00000000000000000000000000000000 @//import/main/checkout.c@ @1.102@ 1 
@pv@ 0 @db.revcx@ 102 @//import/main/checkout.c@ 95 1 
@pv@ 0 @db.desc@ 103 @Sync revisions and time buffers size to be consistent with each others.
Simplifies further size tweaks if needed.
OK niallo@@ ray@@.
@ 
@pv@ 0 @db.change@ 103 103 @svn-client@ @xsa@ 1183066689 1 @Sync revisions and time buffers@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 96 1 1 103 1183066689 1183066689 00000000000000000000000000000000 @//import/main/checkout.c@ @1.103@ 1 
@pv@ 0 @db.revcx@ 103 @//import/main/checkout.c@ 96 1 
@pv@ 0 @db.desc@ 104 @Rework the way opencvs works in relation to files in the Attic/:

Previously, files in the 'Attic/' were linked into our filelist as being
'Attic/filename,v' this caused unneeded stress on certain functions
like cvs_file_classify() who had to do pointer voodoo to split out
the 'Attic/' part and do other very weird stuff to normalize the pathname
of these files.

Instead, we handle these files early in the start when we
build the fileslist in cvs_repository_getdir(). When encountering
the 'Attic/' directory, we recurse in it if required but instead of
using the 'Attic/' directory component as our base directory we stick
with the directory name where 'Attic/' resides in, resulting in the
correct filename while maintaining the correct RCSpath for the file.

This made the following things a lot easier:
(and in most cases actually fixed the below points)

- status with files in Attic/.
- checking out HEAD repositories with files in Attic/.
- checking out repositories with -rTAG.
- updating with -rTAG.

and as an added bonus the following now also works:

- correctly creating CVS/Tag in both local and remote mode thus
  allowing update/status/and more to work correctly with the tagged tree.
  (thanks to the correct handling of -rTAG cases).
- resetting tags with opencvs -A properly works too now.

This is a major step forward into the usability
of OpenCVS when it comes to maintaining multiple tagged trees, the next
logical step would be to fix commiting to branches.

enjoy you -stable cowards.

tested by myself, xsa, niallo and ckuethe
thanks guys!
@ 
@pv@ 0 @db.change@ 104 104 @svn-client@ @joris@ 1183468962 1 @Rework the way opencvs works in@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 97 1 1 104 1183468962 1183468962 00000000000000000000000000000000 @//import/main/checkout.c@ @1.104@ 1 
@pv@ 0 @db.revcx@ 104 @//import/main/checkout.c@ 97 1 
@pv@ 0 @db.desc@ 105 @Support -r for the export command.
@ 
@pv@ 0 @db.change@ 105 105 @svn-client@ @xsa@ 1184746647 1 @Support -r for the export comma@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 98 1 1 105 1184746647 1184746647 00000000000000000000000000000000 @//import/main/checkout.c@ @1.105@ 1 
@pv@ 0 @db.revcx@ 105 @//import/main/checkout.c@ 98 1 
@pv@ 0 @db.desc@ 106 @Correctly handle the export command when writing to history file.
@ 
@pv@ 0 @db.change@ 106 106 @svn-client@ @xsa@ 1185353124 1 @Correctly handle the export com@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 99 1 1 106 1185353124 1185353124 00000000000000000000000000000000 @//import/main/checkout.c@ @1.106@ 1 
@pv@ 0 @db.revcx@ 106 @//import/main/checkout.c@ 99 1 
@pv@ 0 @db.desc@ 107 @Correctly handle the export command when writing to history file.
@ 
@pv@ 0 @db.change@ 107 107 @svn-client@ @xsa@ 1185353124 1 @Correctly handle the export com@ 
@pv@ 0 @db.integed@ @//import/OPENBSD_4_2/checkout.c@ @//import/main/checkout.c@ 0 99 0 1 2 107 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_4_2/checkout.c@ 0 1 0 99 3 107 
@pv@ 3 @db.rev@ @//import/OPENBSD_4_2/checkout.c@ 1 1 3 107 1185353124 1185353124 00000000000000000000000000000000 @//import/main/checkout.c@ @1.106@ 1 
@pv@ 0 @db.revcx@ 107 @//import/OPENBSD_4_2/checkout.c@ 1 3 
@pv@ 0 @db.desc@ 108 @Added support for single file checkout.

OK joris@@
@ 
@pv@ 0 @db.change@ 108 108 @svn-client@ @tobias@ 1189193765 1 @Added support for single file c@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 100 1 1 108 1189193765 1189193765 00000000000000000000000000000000 @//import/main/checkout.c@ @1.108@ 1 
@pv@ 0 @db.revcx@ 108 @//import/main/checkout.c@ 100 1 
@pv@ 0 @db.desc@ 109 @Sprinkle some magic so checkout/update -p works
in both local and server mode.

OK tobias@@
@ 
@pv@ 0 @db.change@ 109 109 @svn-client@ @joris@ 1189206304 1 @Sprinkle some magic so checkout@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 101 1 1 109 1189206304 1189206304 00000000000000000000000000000000 @//import/main/checkout.c@ @1.109@ 1 
@pv@ 0 @db.revcx@ 109 @//import/main/checkout.c@ 101 1 
@pv@ 0 @db.desc@ 110 @Added support for checkout -p with local repository.

OK joris@@
@ 
@pv@ 0 @db.change@ 110 110 @svn-client@ @tobias@ 1189369446 1 @Added support for checkout -p w@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 102 1 1 110 1189369446 1189369446 00000000000000000000000000000000 @//import/main/checkout.c@ @1.110@ 1 
@pv@ 0 @db.revcx@ 110 @//import/main/checkout.c@ 102 1 
@pv@ 0 @db.desc@ 111 @Support for checkout with a local repository already in place.

OK joris@@
@ 
@pv@ 0 @db.change@ 111 111 @svn-client@ @tobias@ 1190475029 1 @Support for checkout with a loc@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 103 1 1 111 1190475029 1190475029 00000000000000000000000000000000 @//import/main/checkout.c@ @1.111@ 1 
@pv@ 0 @db.revcx@ 111 @//import/main/checkout.c@ 103 1 
@pv@ 0 @db.desc@ 112 @better branching/sticky tag support, no branch commits yet though.
@ 
@pv@ 0 @db.change@ 112 112 @svn-client@ @joris@ 1190476882 1 @better branching/sticky tag sup@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 104 1 1 112 1190476882 1190476882 00000000000000000000000000000000 @//import/main/checkout.c@ @1.112@ 1 
@pv@ 0 @db.revcx@ 112 @//import/main/checkout.c@ 104 1 
@pv@ 0 @db.desc@ 113 @make sure when running update -r on existing files to overwrite
the sticky directory tag with it. since -r gets priority.
@ 
@pv@ 0 @db.change@ 113 113 @svn-client@ @joris@ 1190546364 1 @make sure when running update -@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 105 1 1 113 1190546364 1190546364 00000000000000000000000000000000 @//import/main/checkout.c@ @1.113@ 1 
@pv@ 0 @db.revcx@ 113 @//import/main/checkout.c@ 105 1 
@pv@ 0 @db.desc@ 114 @Our keyword expansion had a big flaw, due to this construction:
if (!(mode & RCS_KWEXP_NONE))

RCS_KWEXP_NONE is defined to 0, so expansion happened always.

Left shifted all RCS_KWEXP defines and looked carefully at hard-coded values
throughout the code.
@ 
@pv@ 0 @db.change@ 114 114 @svn-client@ @tobias@ 1199958844 1 @Our keyword expansion had a big@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 106 1 1 114 1199958844 1199958844 00000000000000000000000000000000 @//import/main/checkout.c@ @1.114@ 1 
@pv@ 0 @db.revcx@ 114 @//import/main/checkout.c@ 106 1 
@pv@ 0 @db.desc@ 115 @another strcspn() round
@ 
@pv@ 0 @db.change@ 115 115 @svn-client@ @tobias@ 1199959702 1 @another strcspn() round
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 107 1 1 115 1199959702 1199959702 00000000000000000000000000000000 @//import/main/checkout.c@ @1.115@ 1 
@pv@ 0 @db.revcx@ 115 @//import/main/checkout.c@ 107 1 
@pv@ 0 @db.desc@ 116 @Fixed export to be fully functional and compliant to GNU cvs in local and
remote setups.

OK xsa@@
@ 
@pv@ 0 @db.change@ 116 116 @svn-client@ @tobias@ 1200933406 1 @Fixed export to be fully functi@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 108 1 1 116 1200933406 1200933406 00000000000000000000000000000000 @//import/main/checkout.c@ @1.116@ 1 
@pv@ 0 @db.revcx@ 116 @//import/main/checkout.c@ 108 1 
@pv@ 0 @db.desc@ 117 @Don't reset the sticky tag of a file in CVS/Entries if it is not requested.

OK niallo@@, xsa@@
@ 
@pv@ 0 @db.change@ 117 117 @svn-client@ @tobias@ 1201080848 1 @Don't reset the sticky tag of a@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 109 1 1 117 1201080848 1201080848 00000000000000000000000000000000 @//import/main/checkout.c@ @1.117@ 1 
@pv@ 0 @db.revcx@ 117 @//import/main/checkout.c@ 109 1 
@pv@ 0 @db.desc@ 118 @Properly handle -R -- although it is default, it may be overwritten mit -l
in front of it.

OK joris@@, xsa@@

> Diff from Igor Zinovik
@ 
@pv@ 0 @db.change@ 118 118 @svn-client@ @tobias@ 1201552267 1 @Properly handle -R -- although @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 110 1 1 118 1201552267 1201552267 00000000000000000000000000000000 @//import/main/checkout.c@ @1.118@ 1 
@pv@ 0 @db.revcx@ 118 @//import/main/checkout.c@ 110 1 
@pv@ 0 @db.desc@ 119 @Actually support checkout's -l.

OK xsa@@
@ 
@pv@ 0 @db.change@ 119 119 @svn-client@ @tobias@ 1201556109 1 @Actually support checkout's -l.@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 111 1 1 119 1201556109 1201556109 00000000000000000000000000000000 @//import/main/checkout.c@ @1.119@ 1 
@pv@ 0 @db.revcx@ 119 @//import/main/checkout.c@ 111 1 
@pv@ 0 @db.desc@ 120 @Replaced the unused cvs_command variable cmd_req with cmd_flags, which states
if the current command is supposed to use a working directory or if it is a
repository-only command (as of now checkout -p, rtag, rlog).

Makes the code simpler, easier to read and automagically fixes some issues
we encountered with these commands (for example if a working directory
exists, or "." operations are performed).

OK joris@@, niallo@@
@ 
@pv@ 0 @db.change@ 120 120 @svn-client@ @tobias@ 1201774505 1 @Replaced the unused cvs_command@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 112 1 1 120 1201774505 1201774505 00000000000000000000000000000000 @//import/main/checkout.c@ @1.120@ 1 
@pv@ 0 @db.revcx@ 120 @//import/main/checkout.c@ 112 1 
@pv@ 0 @db.desc@ 121 @We have to carefully check if a checkout command is run with a valid
directory or file.  When it comes to files, check if there is a file
available ending in ,v or if it is in Attic.  Everything else in invalid.

OK joris@@, xsa@@
@ 
@pv@ 0 @db.change@ 121 121 @svn-client@ @tobias@ 1201808339 1 @We have to carefully check if a@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 113 1 1 121 1201808339 1201808339 00000000000000000000000000000000 @//import/main/checkout.c@ @1.121@ 1 
@pv@ 0 @db.revcx@ 121 @//import/main/checkout.c@ 113 1 
@pv@ 0 @db.desc@ 122 @Rename `stickytag' variable to `sticky' for consistency with rest of the code.
@ 
@pv@ 0 @db.change@ 122 122 @svn-client@ @xsa@ 1201808945 1 @Rename `stickytag' variable to @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 114 1 1 122 1201808945 1201808945 00000000000000000000000000000000 @//import/main/checkout.c@ @1.122@ 1 
@pv@ 0 @db.revcx@ 122 @//import/main/checkout.c@ 114 1 
@pv@ 0 @db.desc@ 123 @Make use of CVS_REV_BUFSZ everywhere for `sticky'.
@ 
@pv@ 0 @db.change@ 123 123 @svn-client@ @xsa@ 1201809100 1 @Make use of CVS_REV_BUFSZ every@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 115 1 1 123 1201809100 1201809100 00000000000000000000000000000000 @//import/main/checkout.c@ @1.123@ 1 
@pv@ 0 @db.revcx@ 123 @//import/main/checkout.c@ 115 1 
@pv@ 0 @db.desc@ 124 @initial CVSROOT/modules support, only does aliases at the moment (-a).
"modules.c, hurray!" xsa@@, ok tobias@@
@ 
@pv@ 0 @db.change@ 124 124 @svn-client@ @joris@ 1201980748 1 @initial CVSROOT/modules support@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 116 1 1 124 1201980748 1201980748 00000000000000000000000000000000 @//import/main/checkout.c@ @1.124@ 1 
@pv@ 0 @db.revcx@ 124 @//import/main/checkout.c@ 116 1 
@pv@ 0 @db.desc@ 125 @(f)utimes takes sys/time.h
@ 
@pv@ 0 @db.change@ 125 125 @svn-client@ @tobias@ 1202051284 1 @(f)utimes takes sys/time.h
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 117 1 1 125 1202051284 1202051284 00000000000000000000000000000000 @//import/main/checkout.c@ @1.125@ 1 
@pv@ 0 @db.revcx@ 125 @//import/main/checkout.c@ 117 1 
@pv@ 0 @db.desc@ 126 @cvs_update_leavedir is only useful if dirs have to be pruned.

OK joris@@
@ 
@pv@ 0 @db.change@ 126 126 @svn-client@ @tobias@ 1202052010 1 @cvs_update_leavedir is only use@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 118 1 1 126 1202052010 1202052010 00000000000000000000000000000000 @//import/main/checkout.c@ @1.126@ 1 
@pv@ 0 @db.revcx@ 126 @//import/main/checkout.c@ 118 1 
@pv@ 0 @db.desc@ 127 @better CVSROOT/module support, includes remote support and modules
that are not aliases (-a);

OK tobias@@
@ 
@pv@ 0 @db.change@ 127 127 @svn-client@ @joris@ 1202059214 1 @better CVSROOT/module support, @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 119 1 1 127 1202059214 1202059214 00000000000000000000000000000000 @//import/main/checkout.c@ @1.127@ 1 
@pv@ 0 @db.revcx@ 127 @//import/main/checkout.c@ 119 1 
@pv@ 0 @db.desc@ 128 @with the recent changes for CVSROOT/modules we can now support the
basics of checkout -d. Multiple modules with -d is still "not supported".

example:

$ opencvs -d /cvs co -d kernel_source_3_0 -rOPENBSD_3_0 ksrc

yes, it rocks.

ok tobias@@
@ 
@pv@ 0 @db.change@ 128 128 @svn-client@ @joris@ 1202064152 1 @with the recent changes for CVS@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 120 1 1 128 1202064152 1202064152 00000000000000000000000000000000 @//import/main/checkout.c@ @1.128@ 1 
@pv@ 0 @db.revcx@ 128 @//import/main/checkout.c@ 120 1 
@pv@ 0 @db.desc@ 129 @respect any -l option that might have been set in CVSROOT/modules;
@ 
@pv@ 0 @db.change@ 129 129 @svn-client@ @joris@ 1202068664 1 @respect any -l option that migh@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 121 1 1 129 1202068664 1202068664 00000000000000000000000000000000 @//import/main/checkout.c@ @1.129@ 1 
@pv@ 0 @db.revcx@ 129 @//import/main/checkout.c@ 121 1 
@pv@ 0 @db.desc@ 130 @dont forget to send the -d flag to our server as well if it
was specified;
@ 
@pv@ 0 @db.change@ 130 130 @svn-client@ @joris@ 1202068897 1 @dont forget to send the -d flag@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 122 1 1 130 1202068897 1202068897 00000000000000000000000000000000 @//import/main/checkout.c@ @1.130@ 1 
@pv@ 0 @db.revcx@ 130 @//import/main/checkout.c@ 122 1 
@pv@ 0 @db.desc@ 131 @more CVSROOT/module stuff:

- allow more then 1 module to be specified per definition
- respect the "!" sign which means: "hey ignore this dir when checking out"
- non alias definitions can now contain files

ok tobias@@
@ 
@pv@ 0 @db.change@ 131 131 @svn-client@ @joris@ 1202079028 1 @more CVSROOT/module stuff:

- a@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 123 1 1 131 1202079028 1202079028 00000000000000000000000000000000 @//import/main/checkout.c@ @1.131@ 1 
@pv@ 0 @db.revcx@ 131 @//import/main/checkout.c@ 123 1 
@pv@ 0 @db.desc@ 132 @shuffle some stuff around so we dont end up doing the same things
twice in cvs_module_lookup() and checkout_check_directory();

allow single files to be ignored with ! as well;
@ 
@pv@ 0 @db.change@ 132 132 @svn-client@ @joris@ 1202081681 1 @shuffle some stuff around so we@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 124 1 1 132 1202081681 1202081681 00000000000000000000000000000000 @//import/main/checkout.c@ @1.132@ 1 
@pv@ 0 @db.revcx@ 132 @//import/main/checkout.c@ 124 1 
@pv@ 0 @db.desc@ 133 @Added -k flag support for all commands which support it.

OK joris@@
@ 
@pv@ 0 @db.change@ 133 133 @svn-client@ @tobias@ 1202137652 1 @Added -k flag support for all c@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 125 1 1 133 1202137652 1202137652 00000000000000000000000000000000 @//import/main/checkout.c@ @1.133@ 1 
@pv@ 0 @db.revcx@ 133 @//import/main/checkout.c@ 125 1 
@pv@ 0 @db.desc@ 134 @more CVSROOT/modules stuff:

- support for -i flag:
	Run "prog" on "cvs commit" from top-level of module.
- fix some memory leaks in modules.c
- pass the line number from cvs_read_config() towards the callbacks
  so its easier to print out where it's going wrong, if it ever does.

OK tobias@@
@ 
@pv@ 0 @db.change@ 134 134 @svn-client@ @joris@ 1202152112 1 @more CVSROOT/modules stuff:

- @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 126 1 1 134 1202152112 1202152112 00000000000000000000000000000000 @//import/main/checkout.c@ @1.134@ 1 
@pv@ 0 @db.revcx@ 134 @//import/main/checkout.c@ 126 1 
@pv@ 0 @db.desc@ 135 @implement -n for checkout:
	"Do not execute programs listed in the CVSROOT/modules file."

ok tobias@@, pleasekeepthingssortedktnx xsa@@
@ 
@pv@ 0 @db.change@ 135 135 @svn-client@ @joris@ 1202160557 1 @implement -n for checkout:
	"Do@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 127 1 1 135 1202160557 1202160557 00000000000000000000000000000000 @//import/main/checkout.c@ @1.135@ 1 
@pv@ 0 @db.revcx@ 135 @//import/main/checkout.c@ 127 1 
@pv@ 0 @db.desc@ 136 @CVSROOT/modules:

correct -i and -o usage

-i runs the program specified on commit
-o runs the program specified on checkout
@ 
@pv@ 0 @db.change@ 136 136 @svn-client@ @joris@ 1202164600 1 @CVSROOT/modules:

correct -i an@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 128 1 1 136 1202164600 1202164600 00000000000000000000000000000000 @//import/main/checkout.c@ @1.136@ 1 
@pv@ 0 @db.revcx@ 136 @//import/main/checkout.c@ 128 1 
@pv@ 0 @db.desc@ 137 @lets do co -c as well (list available modules) and do it in 1/6th of the
lines GNU cvs does it in, without actually fucking up on bad lines,
like gnucvs.

ok tobias@@
@ 
@pv@ 0 @db.change@ 137 137 @svn-client@ @joris@ 1202337802 1 @lets do co -c as well (list ava@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 129 1 1 137 1202337802 1202337802 00000000000000000000000000000000 @//import/main/checkout.c@ @1.137@ 1 
@pv@ 0 @db.revcx@ 137 @//import/main/checkout.c@ 129 1 
@pv@ 0 @db.desc@ 138 @exit() needs stdlib.h
@ 
@pv@ 0 @db.change@ 138 138 @svn-client@ @xsa@ 1202370600 1 @exit() needs stdlib.h
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 130 1 1 138 1202370600 1202370600 00000000000000000000000000000000 @//import/main/checkout.c@ @1.138@ 1 
@pv@ 0 @db.revcx@ 138 @//import/main/checkout.c@ 130 1 
@pv@ 0 @db.desc@ 139 @Get in initial support for checkout -D.  Works fine with -r support right
now.

OK joris@@
@ 
@pv@ 0 @db.change@ 139 139 @svn-client@ @tobias@ 1202555822 1 @Get in initial support for chec@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 131 1 1 139 1202555822 1202555822 00000000000000000000000000000000 @//import/main/checkout.c@ @1.139@ 1 
@pv@ 0 @db.revcx@ 139 @//import/main/checkout.c@ 131 1 
@pv@ 0 @db.desc@ 140 @Get in proper support for checkout/update -A when it comes to keyword
expansion options.

OK joris@@
@ 
@pv@ 0 @db.change@ 140 140 @svn-client@ @tobias@ 1202559633 1 @Get in proper support for check@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 132 1 1 140 1202559633 1202559633 00000000000000000000000000000000 @//import/main/checkout.c@ @1.140@ 1 
@pv@ 0 @db.revcx@ 140 @//import/main/checkout.c@ 132 1 
@pv@ 0 @db.desc@ 141 @remote improvements:

- make sure the client creates the correct CVS/Repository when running
  checkout if there was no -d targetdir specified.
- allow -D to work remotely for both checkout and update.
@ 
@pv@ 0 @db.change@ 141 141 @svn-client@ @joris@ 1202561303 1 @remote improvements:

- make su@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 133 1 1 141 1202561303 1202561303 00000000000000000000000000000000 @//import/main/checkout.c@ @1.141@ 1 
@pv@ 0 @db.revcx@ 141 @//import/main/checkout.c@ 133 1 
@pv@ 0 @db.desc@ 142 @Support for checkout -D extended:
Properly write CVS/Tag and CVS/Entries on various combinations of -r and -D.

OK joris@@
@ 
@pv@ 0 @db.change@ 142 142 @svn-client@ @tobias@ 1202576503 1 @Support for checkout -D extende@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 134 1 1 142 1202576503 1202576503 00000000000000000000000000000000 @//import/main/checkout.c@ @1.142@ 1 
@pv@ 0 @db.revcx@ 142 @//import/main/checkout.c@ 134 1 
@pv@ 0 @db.desc@ 143 @Introduce cvs_ent_line_str() - formats CVS/Entries lines.
OK tobias@@.
@ 
@pv@ 0 @db.change@ 143 143 @svn-client@ @xsa@ 1202587440 1 @Introduce cvs_ent_line_str() - @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 135 1 1 143 1202587440 1202587440 00000000000000000000000000000000 @//import/main/checkout.c@ @1.143@ 1 
@pv@ 0 @db.revcx@ 143 @//import/main/checkout.c@ 135 1 
@pv@ 0 @db.desc@ 144 @properly initialize cvs_specified_date so we dont end up with
random stuff going on
@ 
@pv@ 0 @db.change@ 144 144 @svn-client@ @joris@ 1202638902 1 @properly initialize cvs_specifi@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 136 1 1 144 1202638902 1202638902 00000000000000000000000000000000 @//import/main/checkout.c@ @1.144@ 1 
@pv@ 0 @db.revcx@ 144 @//import/main/checkout.c@ 136 1 
@pv@ 0 @db.desc@ 145 @Respond with "Updated" instead of "Checked-in" on server-side if a client
committed files, so keywords are expanded properly.

On client-side, we have to be careful about Directory ./ when it comes
to commits, so add a test for CVS_OP_COMMIT.

OK and help from joris@@
@ 
@pv@ 0 @db.change@ 145 145 @svn-client@ @tobias@ 1202648468 1 @Respond with "Updated" instead @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 137 1 1 145 1202648468 1202648468 00000000000000000000000000000000 @//import/main/checkout.c@ @1.145@ 1 
@pv@ 0 @db.revcx@ 145 @//import/main/checkout.c@ 137 1 
@pv@ 0 @db.desc@ 146 @+ #define CVS_DATE_FMT   "%Y.%m.%d.%H.%M.%S"
...and use it.
@ 
@pv@ 0 @db.change@ 146 146 @svn-client@ @xsa@ 1202652532 1 @+ #define CVS_DATE_FMT   "%Y.%m@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 138 1 1 146 1202652532 1202652532 00000000000000000000000000000000 @//import/main/checkout.c@ @1.146@ 1 
@pv@ 0 @db.revcx@ 146 @//import/main/checkout.c@ 138 1 
@pv@ 0 @db.desc@ 147 @Properly handle return value of dirname().

OK joris@@
@ 
@pv@ 0 @db.change@ 147 147 @svn-client@ @tobias@ 1203883445 1 @Properly handle return value of@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 139 1 1 147 1203883445 1203883445 00000000000000000000000000000000 @//import/main/checkout.c@ @1.147@ 1 
@pv@ 0 @db.revcx@ 147 @//import/main/checkout.c@ 139 1 
@pv@ 0 @db.desc@ 148 @prevent file races

ok tobias@@
@ 
@pv@ 0 @db.change@ 148 148 @svn-client@ @joris@ 1204151644 1 @prevent file races

ok tobias@@
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 140 1 1 148 1204151644 1204151644 00000000000000000000000000000000 @//import/main/checkout.c@ @1.148@ 1 
@pv@ 0 @db.revcx@ 148 @//import/main/checkout.c@ 140 1 
@pv@ 0 @db.desc@ 149 @handle file permissions and owners properly.
matches what gnu cvs does.

fixes the fact that we couldnt update group writable files.

problem report & diff testing by David Crawshaw.
@ 
@pv@ 0 @db.change@ 149 149 @svn-client@ @joris@ 1204321437 1 @handle file permissions and own@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 141 1 1 149 1204321437 1204321437 00000000000000000000000000000000 @//import/main/checkout.c@ @1.149@ 1 
@pv@ 0 @db.revcx@ 149 @//import/main/checkout.c@ 141 1 
@pv@ 0 @db.desc@ 150 @handle file permissions and owners properly.
matches what gnu cvs does.

fixes the fact that we couldnt update group writable files.

problem report & diff testing by David Crawshaw.
@ 
@pv@ 0 @db.change@ 150 150 @svn-client@ @joris@ 1204321437 1 @handle file permissions and own@ 
@pv@ 0 @db.integed@ @//import/OPENBSD_4_3/checkout.c@ @//import/main/checkout.c@ 0 141 0 1 2 150 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_4_3/checkout.c@ 0 1 0 141 3 150 
@pv@ 3 @db.rev@ @//import/OPENBSD_4_3/checkout.c@ 1 1 3 150 1204321437 1204321437 00000000000000000000000000000000 @//import/main/checkout.c@ @1.149@ 1 
@pv@ 0 @db.revcx@ 150 @//import/OPENBSD_4_3/checkout.c@ 1 3 
@pv@ 0 @db.desc@ 151 @add checkout/update -j support.
still has some rough edges.
@ 
@pv@ 0 @db.change@ 151 151 @svn-client@ @joris@ 1205007994 1 @add checkout/update -j support.@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 142 1 1 151 1205007994 1205007994 00000000000000000000000000000000 @//import/main/checkout.c@ @1.151@ 1 
@pv@ 0 @db.revcx@ 151 @//import/main/checkout.c@ 142 1 
@pv@ 0 @db.desc@ 152 @proper repository locking:
- all read operations now look for a lock, and wait if present but never
  try to lock the tree themselfs anymore.
- all write operations lock the tree where needed.
- commit locks all relevant directories before even attempting to start.
@ 
@pv@ 0 @db.change@ 152 152 @svn-client@ @joris@ 1205032492 1 @proper repository locking:
- al@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 143 1 1 152 1205032492 1205032492 00000000000000000000000000000000 @//import/main/checkout.c@ @1.152@ 1 
@pv@ 0 @db.revcx@ 152 @//import/main/checkout.c@ 143 1 
@pv@ 0 @db.desc@ 153 @expension -> expansion

ok joris, xsa (quite some time ago)
@ 
@pv@ 0 @db.change@ 153 153 @svn-client@ @tobias@ 1211471101 1 @expension -> expansion

ok jori@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 144 1 1 153 1211471101 1211471101 00000000000000000000000000000000 @//import/main/checkout.c@ @1.153@ 1 
@pv@ 0 @db.revcx@ 153 @//import/main/checkout.c@ 144 1 
@pv@ 0 @db.desc@ 154 @Avoid memory leaks in directory tag handling by always allocating and
always freeing dirtag.

ok joris
@ 
@pv@ 0 @db.change@ 154 154 @svn-client@ @tobias@ 1212894187 1 @Avoid memory leaks in directory@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 145 1 1 154 1212894187 1212894187 00000000000000000000000000000000 @//import/main/checkout.c@ @1.154@ 1 
@pv@ 0 @db.revcx@ 154 @//import/main/checkout.c@ 145 1 
@pv@ 0 @db.desc@ 155 @simplification from igor
@ 
@pv@ 0 @db.change@ 155 155 @svn-client@ @joris@ 1212961736 1 @simplification from igor
@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 146 1 1 155 1212961736 1212961736 00000000000000000000000000000000 @//import/main/checkout.c@ @1.155@ 1 
@pv@ 0 @db.revcx@ 155 @//import/main/checkout.c@ 146 1 
@pv@ 0 @db.desc@ 156 @New trigger framework that allows us to run the required scripts
defined in CVSROOT/commitinfo and CVSROOT/loginfo and so on.

This enables the use of log_accum2 and all that other nice stuff we like.

This was mostly written by Jonathan Armani with help from tobias@@ and myself.

ok tobias@@
@ 
@pv@ 0 @db.change@ 156 156 @svn-client@ @joris@ 1213059634 1 @New trigger framework that allo@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 147 1 1 156 1213059634 1213059634 00000000000000000000000000000000 @//import/main/checkout.c@ @1.156@ 1 
@pv@ 0 @db.revcx@ 156 @//import/main/checkout.c@ 147 1 
@pv@ 0 @db.desc@ 157 @properly inherit file permissions.

reported & tested by phessler@@
input otto@@ deraadt@@
ok tobias@@
@ 
@pv@ 0 @db.change@ 157 157 @svn-client@ @joris@ 1213129817 1 @properly inherit file permissio@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 148 1 1 157 1213129817 1213129817 00000000000000000000000000000000 @//import/main/checkout.c@ @1.157@ 1 
@pv@ 0 @db.revcx@ 157 @//import/main/checkout.c@ 148 1 
@pv@ 0 @db.desc@ 158 @Avoid possible NULL pointer dereferences by using reentrant versions
of time functions.

ok joris
@ 
@pv@ 0 @db.change@ 158 158 @svn-client@ @tobias@ 1213150753 1 @Avoid possible NULL pointer der@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 149 1 1 158 1213150753 1213150753 00000000000000000000000000000000 @//import/main/checkout.c@ @1.158@ 1 
@pv@ 0 @db.revcx@ 158 @//import/main/checkout.c@ 149 1 
@pv@ 0 @db.desc@ 159 @always enter cvs_update_leavedir()
@ 
@pv@ 0 @db.change@ 159 159 @svn-client@ @joris@ 1213219490 1 @always enter cvs_update_leavedi@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 150 1 1 159 1213219490 1213219490 00000000000000000000000000000000 @//import/main/checkout.c@ @1.159@ 1 
@pv@ 0 @db.revcx@ 159 @//import/main/checkout.c@ 150 1 
@pv@ 0 @db.desc@ 160 @completely kill the need for TMP_DIR when running checkout,
which gives us better performance among other things.

this is however disabled in a few cases:
1) whenever you run checkout over an existing tree (which acts as update)
2) whenever you specify -d or a module alias

we're planning on enabling this behaviour for case 2 in the future.

anoncvs sysadmins now love us even more.

ok tobias@@
@ 
@pv@ 0 @db.change@ 160 160 @svn-client@ @joris@ 1213254974 1 @completely kill the need for TM@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 151 1 1 160 1213254974 1213254974 00000000000000000000000000000000 @//import/main/checkout.c@ @1.160@ 1 
@pv@ 0 @db.revcx@ 160 @//import/main/checkout.c@ 151 1 
@pv@ 0 @db.desc@ 161 @Fixed a memory leak in export noticed by joris.

ok joris
@ 
@pv@ 0 @db.change@ 161 161 @svn-client@ @tobias@ 1213289748 1 @Fixed a memory leak in export n@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 152 1 1 161 1213289748 1213289748 00000000000000000000000000000000 @//import/main/checkout.c@ @1.161@ 1 
@pv@ 0 @db.revcx@ 161 @//import/main/checkout.c@ 152 1 
@pv@ 0 @db.desc@ 162 @don't always re-open the same CVS/Entries file, instead keep the
last opened CVS/Entries around to operate on and close it whenever
we switch directory. gives us a small performance boost, obviously.

while doing this, switch the way we write revisions to disk by
using fwrite(3) so stuff can get written to disk in chunks
instead of writing everything line by line, another win.

with help from otto@@
ok tobias@@
@ 
@pv@ 0 @db.change@ 162 162 @svn-client@ @joris@ 1213413555 1 @don't always re-open the same C@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 153 1 1 162 1213413555 1213413555 00000000000000000000000000000000 @//import/main/checkout.c@ @1.162@ 1 
@pv@ 0 @db.revcx@ 162 @//import/main/checkout.c@ 153 1 
@pv@ 0 @db.desc@ 163 @Added support for sticky date set in CVS/Tag and CVS/Entries per directory.

ok joris
@ 
@pv@ 0 @db.change@ 163 163 @svn-client@ @tobias@ 1213415909 1 @Added support for sticky date s@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 154 1 1 163 1213415909 1213415909 00000000000000000000000000000000 @//import/main/checkout.c@ @1.163@ 1 
@pv@ 0 @db.revcx@ 163 @//import/main/checkout.c@ 154 1 
@pv@ 0 @db.desc@ 164 @Conforming to RCS specification, it is possible but unlikely to encounter
an RCS file which has no head revision set.  Some commands actually can
work with them (log, status) so support these files. Fixes  A LOT of
possible segmentation faults.

ok joris
@ 
@pv@ 0 @db.change@ 164 164 @svn-client@ @tobias@ 1213418048 1 @Conforming to RCS specification@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 155 1 1 164 1213418048 1213418048 00000000000000000000000000000000 @//import/main/checkout.c@ @1.164@ 1 
@pv@ 0 @db.revcx@ 164 @//import/main/checkout.c@ 155 1 
@pv@ 0 @db.desc@ 165 @use cf->fd in cvs_remote_sendfile() instead of using a local
variable that is only used once, which is in this case.
@ 
@pv@ 0 @db.change@ 165 165 @svn-client@ @joris@ 1215520198 1 @use cf->fd in cvs_remote_sendfi@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 156 1 1 165 1215520198 1215520198 00000000000000000000000000000000 @//import/main/checkout.c@ @1.165@ 1 
@pv@ 0 @db.revcx@ 165 @//import/main/checkout.c@ 156 1 
@pv@ 0 @db.desc@ 166 @use cf->fd in cvs_remote_sendfile() instead of using a local
variable that is only used once, which is in this case.
@ 
@pv@ 0 @db.change@ 166 166 @svn-client@ @joris@ 1215520198 1 @use cf->fd in cvs_remote_sendfi@ 
@pv@ 0 @db.integed@ @//import/OPENBSD_4_4/checkout.c@ @//import/main/checkout.c@ 0 156 0 1 2 166 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_4_4/checkout.c@ 0 1 0 156 3 166 
@pv@ 3 @db.rev@ @//import/OPENBSD_4_4/checkout.c@ 1 1 3 166 1215520198 1215520198 00000000000000000000000000000000 @//import/main/checkout.c@ @1.165@ 1 
@pv@ 0 @db.revcx@ 166 @//import/OPENBSD_4_4/checkout.c@ 1 3 
@pv@ 0 @db.desc@ 167 @enable -d for the export command.
ok joris@@
@ 
@pv@ 0 @db.change@ 167 167 @svn-client@ @pyr@ 1233164413 1 @enable -d for the export comman@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 157 1 1 167 1233164413 1233164413 00000000000000000000000000000000 @//import/main/checkout.c@ @1.167@ 1 
@pv@ 0 @db.revcx@ 167 @//import/main/checkout.c@ 157 1 
@pv@ 0 @db.desc@ 168 @use file_flags for 2 more reasons:
- mark a file as being inside the Attic/
- mark a file as existing in the working copy
  (both in local and remote mode)

this way we no longer will need to check if cf->fd == -1 and
think about wether or not we are in local or remote mode.
@ 
@pv@ 0 @db.change@ 168 168 @svn-client@ @joris@ 1235223858 1 @use file_flags for 2 more reaso@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 158 1 1 168 1235223858 1235223858 00000000000000000000000000000000 @//import/main/checkout.c@ @1.168@ 1 
@pv@ 0 @db.revcx@ 168 @//import/main/checkout.c@ 158 1 
@pv@ 0 @db.desc@ 169 @use FILE_ON_DISK flags when we need to verify if a file
exists in the working copy or not instead of checking fd being -1
since this can differ in server or local mode.
@ 
@pv@ 0 @db.change@ 169 169 @svn-client@ @joris@ 1235227853 1 @use FILE_ON_DISK flags when we @ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 159 1 1 169 1235227853 1235227853 00000000000000000000000000000000 @//import/main/checkout.c@ @1.169@ 1 
@pv@ 0 @db.revcx@ 169 @//import/main/checkout.c@ 159 1 
@pv@ 0 @db.desc@ 170 @we no longer push out Set-sticky to the client when writing
our Tag file on the server or in cvs_mkpath(), this caused
problems for the "fast checkout" mechanism when a tag was supplied.

instead, write out any directory sticky tag when we are checking
out a file in that directory, this way we can use our "fast checkout"
mechanism (no /tmp required) even for -r and -d without breaking
working copies because they were missing CVS/Tag files.

"looks good" tobias@@
@ 
@pv@ 0 @db.change@ 170 170 @svn-client@ @joris@ 1235424728 1 @we no longer push out Set-stick@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 160 1 1 170 1235424728 1235424728 00000000000000000000000000000000 @//import/main/checkout.c@ @1.170@ 1 
@pv@ 0 @db.revcx@ 170 @//import/main/checkout.c@ 160 1 
@pv@ 0 @db.desc@ 171 @we no longer push out Set-sticky to the client when writing
our Tag file on the server or in cvs_mkpath(), this caused
problems for the "fast checkout" mechanism when a tag was supplied.

instead, write out any directory sticky tag when we are checking
out a file in that directory, this way we can use our "fast checkout"
mechanism (no /tmp required) even for -r and -d without breaking
working copies because they were missing CVS/Tag files.

"looks good" tobias@@
@ 
@pv@ 0 @db.change@ 171 171 @svn-client@ @joris@ 1235424728 1 @we no longer push out Set-stick@ 
@pv@ 0 @db.integed@ @//import/OPENBSD_4_5/checkout.c@ @//import/main/checkout.c@ 0 160 0 1 2 171 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_4_5/checkout.c@ 0 1 0 160 3 171 
@pv@ 3 @db.rev@ @//import/OPENBSD_4_5/checkout.c@ 1 1 3 171 1235424728 1235424728 00000000000000000000000000000000 @//import/main/checkout.c@ @1.170@ 1 
@pv@ 0 @db.revcx@ 171 @//import/OPENBSD_4_5/checkout.c@ 1 3 
@pv@ 0 @db.desc@ 172 @be carefull when trying to access cf->file_rcs in cvs_checkout_file()
as it could be NULL under certain conditions.
@ 
@pv@ 0 @db.change@ 172 172 @svn-client@ @joris@ 1237367649 1 @be carefull when trying to acce@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 161 1 1 172 1237367649 1237367649 00000000000000000000000000000000 @//import/main/checkout.c@ @1.172@ 1 
@pv@ 0 @db.revcx@ 172 @//import/main/checkout.c@ 161 1 
@pv@ 0 @db.desc@ 173 @switch our file and directory lists to RB trees (see tree(3)),
so we can benefit from faster lookup times while recursing.
@ 
@pv@ 0 @db.change@ 173 173 @svn-client@ @joris@ 1238017833 1 @switch our file and directory l@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 162 1 1 173 1238017833 1238017833 00000000000000000000000000000000 @//import/main/checkout.c@ @1.173@ 1 
@pv@ 0 @db.revcx@ 173 @//import/main/checkout.c@ 162 1 
@pv@ 0 @db.desc@ 174 @make sure that when we try to send a Set-sticky to the client,
we only do so if the file we're checking out was not supplied
on the command-line. Otherwise we'll end up setting CVS/Tag
for the entire directory instead of slapping a sticky tag
only on the file supplied.
@ 
@pv@ 0 @db.change@ 174 174 @svn-client@ @joris@ 1238138937 1 @make sure that when we try to s@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 163 1 1 174 1238138937 1238138937 00000000000000000000000000000000 @//import/main/checkout.c@ @1.174@ 1 
@pv@ 0 @db.revcx@ 174 @//import/main/checkout.c@ 163 1 
@pv@ 0 @db.desc@ 175 @make sure we handle allowed options in cvs_export() instead
of ignoring them, even if they are just stubs.
unbreaks export with gnu cvs clients.
@ 
@pv@ 0 @db.change@ 175 175 @svn-client@ @joris@ 1239000356 1 @make sure we handle allowed opt@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 164 1 1 175 1239000356 1239000356 00000000000000000000000000000000 @//import/main/checkout.c@ @1.175@ 1 
@pv@ 0 @db.revcx@ 175 @//import/main/checkout.c@ 164 1 
@pv@ 0 @db.desc@ 176 @Use correct synopses for checkout and export when an invalid -k option
is specified. From Dawe in user/6177.
@ 
@pv@ 0 @db.change@ 176 176 @svn-client@ @sthen@ 1245615781 1 @Use correct synopses for checko@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 165 1 1 176 1245615781 1245615781 00000000000000000000000000000000 @//import/main/checkout.c@ @1.176@ 1 
@pv@ 0 @db.revcx@ 176 @//import/main/checkout.c@ 165 1 
@pv@ 0 @db.desc@ 177 @Use correct synopses for checkout and export when an invalid -k option
is specified. From Dawe in user/6177.
@ 
@pv@ 0 @db.change@ 177 177 @svn-client@ @sthen@ 1245615781 1 @Use correct synopses for checko@ 
@pv@ 0 @db.integed@ @//import/OPENBSD_4_6/checkout.c@ @//import/main/checkout.c@ 0 165 0 1 2 177 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_4_6/checkout.c@ 0 1 0 165 3 177 
@pv@ 3 @db.rev@ @//import/OPENBSD_4_6/checkout.c@ 1 1 3 177 1245615781 1245615781 00000000000000000000000000000000 @//import/main/checkout.c@ @1.176@ 1 
@pv@ 0 @db.revcx@ 177 @//import/OPENBSD_4_6/checkout.c@ 1 3 
@pv@ 0 @db.integed@ @//import/OPENBSD_4_7/checkout.c@ @//import/main/checkout.c@ 0 165 0 1 2 177 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_4_7/checkout.c@ 0 1 0 165 3 177 
@pv@ 3 @db.rev@ @//import/OPENBSD_4_7/checkout.c@ 1 1 3 177 1245615781 1245615781 00000000000000000000000000000000 @//import/main/checkout.c@ @1.176@ 1 
@pv@ 0 @db.revcx@ 177 @//import/OPENBSD_4_7/checkout.c@ 1 3 
@pv@ 0 @db.desc@ 178 @Reduce variable/function name and whitespace differences between
cvs/rcs.

OK xsa zinovik
@ 
@pv@ 0 @db.change@ 178 178 @svn-client@ @ray@ 1279921565 1 @Reduce variable/function name a@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 166 1 1 178 1279921565 1279921565 00000000000000000000000000000000 @//import/main/checkout.c@ @1.178@ 1 
@pv@ 0 @db.revcx@ 178 @//import/main/checkout.c@ 166 1 
@pv@ 0 @db.desc@ 179 @Check date_parse return values.

OK xsa
@ 
@pv@ 0 @db.change@ 179 179 @svn-client@ @ray@ 1280526438 1 @Check date_parse return values.@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 167 1 1 179 1280526438 1280526438 00000000000000000000000000000000 @//import/main/checkout.c@ @1.179@ 1 
@pv@ 0 @db.revcx@ 179 @//import/main/checkout.c@ 167 1 
@pv@ 0 @db.desc@ 180 @Check date_parse return values.

OK xsa
@ 
@pv@ 0 @db.change@ 180 180 @svn-client@ @ray@ 1280526438 1 @Check date_parse return values.@ 
@pv@ 0 @db.integed@ @//import/OPENBSD_4_8/checkout.c@ @//import/main/checkout.c@ 0 167 0 1 2 180 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_4_8/checkout.c@ 0 1 0 167 3 180 
@pv@ 3 @db.rev@ @//import/OPENBSD_4_8/checkout.c@ 1 1 3 180 1280526438 1280526438 00000000000000000000000000000000 @//import/main/checkout.c@ @1.179@ 1 
@pv@ 0 @db.revcx@ 180 @//import/OPENBSD_4_8/checkout.c@ 1 3 
@pv@ 0 @db.integed@ @//import/OPENBSD_4_9/checkout.c@ @//import/main/checkout.c@ 0 167 0 1 2 180 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_4_9/checkout.c@ 0 1 0 167 3 180 
@pv@ 3 @db.rev@ @//import/OPENBSD_4_9/checkout.c@ 1 1 3 180 1280526438 1280526438 00000000000000000000000000000000 @//import/main/checkout.c@ @1.179@ 1 
@pv@ 0 @db.revcx@ 180 @//import/OPENBSD_4_9/checkout.c@ 1 3 
@pv@ 0 @db.integed@ @//import/OPENBSD_5_0/checkout.c@ @//import/main/checkout.c@ 0 167 0 1 2 180 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_5_0/checkout.c@ 0 1 0 167 3 180 
@pv@ 3 @db.rev@ @//import/OPENBSD_5_0/checkout.c@ 1 1 3 180 1280526438 1280526438 00000000000000000000000000000000 @//import/main/checkout.c@ @1.179@ 1 
@pv@ 0 @db.revcx@ 180 @//import/OPENBSD_5_0/checkout.c@ 1 3 
@pv@ 0 @db.desc@ 181 @Move some global variables/statics to locals, from Michael W
Bombardieri.
@ 
@pv@ 0 @db.change@ 181 181 @svn-client@ @nicm@ 1324994341 1 @Move some global variables/stat@ 
@pv@ 3 @db.rev@ @//import/main/checkout.c@ 168 1 1 181 1324994341 1324994341 00000000000000000000000000000000 @//import/main/checkout.c@ @1.181@ 1 
@pv@ 0 @db.revcx@ 181 @//import/main/checkout.c@ 168 1 
@pv@ 0 @db.desc@ 182 @Move some global variables/statics to locals, from Michael W
Bombardieri.
@ 
@pv@ 0 @db.change@ 182 182 @svn-client@ @nicm@ 1324994341 1 @Move some global variables/stat@ 
@pv@ 0 @db.integed@ @//import/OPENBSD_5_5/checkout.c@ @//import/main/checkout.c@ 0 168 0 1 2 182 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_5_5/checkout.c@ 0 1 0 168 3 182 
@pv@ 3 @db.rev@ @//import/OPENBSD_5_5/checkout.c@ 1 1 3 182 1324994341 1324994341 00000000000000000000000000000000 @//import/main/checkout.c@ @1.181@ 1 
@pv@ 0 @db.revcx@ 182 @//import/OPENBSD_5_5/checkout.c@ 1 3 
@pv@ 0 @db.integed@ @//import/OPENBSD_5_3/checkout.c@ @//import/main/checkout.c@ 0 168 0 1 2 182 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_5_3/checkout.c@ 0 1 0 168 3 182 
@pv@ 3 @db.rev@ @//import/OPENBSD_5_3/checkout.c@ 1 1 3 182 1324994341 1324994341 00000000000000000000000000000000 @//import/main/checkout.c@ @1.181@ 1 
@pv@ 0 @db.revcx@ 182 @//import/OPENBSD_5_3/checkout.c@ 1 3 
@pv@ 0 @db.integed@ @//import/OPENBSD_5_1/checkout.c@ @//import/main/checkout.c@ 0 168 0 1 2 182 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_5_1/checkout.c@ 0 1 0 168 3 182 
@pv@ 3 @db.rev@ @//import/OPENBSD_5_1/checkout.c@ 1 1 3 182 1324994341 1324994341 00000000000000000000000000000000 @//import/main/checkout.c@ @1.181@ 1 
@pv@ 0 @db.revcx@ 182 @//import/OPENBSD_5_1/checkout.c@ 1 3 
@pv@ 0 @db.integed@ @//import/OPENBSD_5_4/checkout.c@ @//import/main/checkout.c@ 0 168 0 1 2 182 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_5_4/checkout.c@ 0 1 0 168 3 182 
@pv@ 3 @db.rev@ @//import/OPENBSD_5_4/checkout.c@ 1 1 3 182 1324994341 1324994341 00000000000000000000000000000000 @//import/main/checkout.c@ @1.181@ 1 
@pv@ 0 @db.revcx@ 182 @//import/OPENBSD_5_4/checkout.c@ 1 3 
@pv@ 0 @db.integed@ @//import/OPENBSD_5_2/checkout.c@ @//import/main/checkout.c@ 0 168 0 1 2 182 
@pv@ 0 @db.integed@ @//import/main/checkout.c@ @//import/OPENBSD_5_2/checkout.c@ 0 1 0 168 3 182 
@pv@ 3 @db.rev@ @//import/OPENBSD_5_2/checkout.c@ 1 1 3 182 1324994341 1324994341 00000000000000000000000000000000 @//import/main/checkout.c@ @1.181@ 1 
@pv@ 0 @db.revcx@ 182 @//import/OPENBSD_5_2/checkout.c@ 1 3 
@rv@ 1 @db.counters@ @change@ @182@ 
@rv@ 1 @db.counters@ @svn2p4.version@ @alpha/TestMode@ 
